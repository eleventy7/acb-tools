---
category: 'article'
cover: './top.jpg'
title: 'Resilient Gateways'
subtitle: 'Adding resilience to Aeron Cluster Gateways'
description: 'Adding resilience to Aeron Cluster Gateways'
date: '2020-10-30'
tags: ['Distributed Systems', 'Aeron']
published: true
state: draft
updated: '2020-11-08'
importance: medium
series: part of the building a venue series
seriesurl: ../../building-a-venue
review: continuous
---


<div class="bg-shaunnew-400 p-4 mb-4 rounded-md dark:text-black">
  <p class="font-bold">Summary</p>
Leadership election and optimal task balancing are vital functions in any distributed system. Adding logic into Aeron Cluster to perform this is simple and can allow the wider system estate to be simplified.

  <p class="italic">Valid Scenarios</p>

 Systems without extremely strict performance requirements or in any scenario where the cluster or cluster log needs to be protected from unnecessary inputs.
 Systems where the cluster needs or already manages the underlying data; this should not be used in a scenario where it would force data through a cluster just to gain a simplified estate.
</div>
Aeron Cluster provides a RAFT service container for running your business logic. By pushing some resilience logic into the cluster, you can simplify the architecture of the system while still meeting strict performance and resilience guarantees.

Let's consider an example common in trading systems - outbound trade integration flows. We start with a trading system which contains the core system state within an Aeron cluster. For every trading party involved, we need to open up exactly one API connection to a third party system so that we can send trade confirmation data. Additionally, we must ensure that the system has built-in resilience and can recover itself from typical failures.

*Reminder:* To ensure determinism, RAFT discourages any I/O from cluster nodes apart from those sent via the RAFT protocol.

## Approach 1: Use an external service to manage API gateway connectivity and resilience
<div align="center">
<svg width="80%" height="auto" viewBox="0 0 957 699" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect y="192" width="164" height="96" rx="4" fill="#5AC8FA"/>
<rect x="291" y="192" width="164" height="96" rx="4" fill="#5AC8FA"/>
<rect x="728" y="72" width="164" height="96" rx="4" fill="#FF2E55"/>
<text fill="black" xml:space="preserve" font-family="-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, sans-serif" font-size="21" letter-spacing="0px"><tspan x="357.312" y="229.472">API&#10;</tspan><tspan x="324.273" y="254.472">Gateway 2</tspan></text>
<rect x="728" y="285" width="164" height="96" rx="4" fill="#FF2E55"/>
<text fill="black" xml:space="preserve" font-family="-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, sans-serif" font-size="21" letter-spacing="0px"><tspan x="779.277" y="114.472">Consul&#10;</tspan><tspan x="778.313" y="139.472">Leader</tspan></text>
<rect x="728" y="498" width="164" height="96" rx="4" fill="#FF2E55"/>
<rect y="422" width="164" height="96" rx="4" fill="#2ACC41"/>
<rect x="291" y="422" width="164" height="96" rx="4" fill="#2ACC41"/>
<rect x="146" y="603" width="164" height="96" rx="4" fill="#2ACC41"/>
<rect width="455" height="58" rx="4" fill="#FFCC02"/>
<text fill="black" xml:space="preserve" font-family="-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, sans-serif" font-size="21" letter-spacing="0px"><tspan x="150" y="36.472">Remote System</tspan></text>
<text fill="black" xml:space="preserve" font-family="-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, sans-serif" font-size="21" letter-spacing="0px"><tspan x="66.3115" y="229.472">API&#10;</tspan><tspan x="33.2734" y="254.472">Gateway 1</tspan></text>
<text fill="black" xml:space="preserve" font-family="-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, sans-serif" font-size="21" letter-spacing="0px"><tspan x="50.1235" y="464.472">Cluster&#10;</tspan><tspan x="51.313" y="489.472">Leader</tspan></text>
<text fill="black" xml:space="preserve" font-family="-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, sans-serif" font-size="21" letter-spacing="0px"><tspan x="339.624" y="464.472">Cluster&#10;</tspan><tspan x="324.109" y="489.472">Follower 1</tspan></text>
<text fill="black" xml:space="preserve" font-family="-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, sans-serif" font-size="21" letter-spacing="0px"><tspan x="194.624" y="646.472">Cluster&#10;</tspan><tspan x="179.109" y="671.472">Follower 2</tspan></text>
<text fill="black" xml:space="preserve" font-family="-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, sans-serif" font-size="21" letter-spacing="0px"><tspan x="779.277" y="327.472">Consul&#10;</tspan><tspan x="777.4" y="352.472">Node 2</tspan></text>
<text fill="black" xml:space="preserve" font-family="-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, sans-serif" font-size="21" letter-spacing="0px"><tspan x="779.277" y="540.472">Consul&#10;</tspan><tspan x="777.4" y="565.472">Node 3</tspan></text>
<path d="M82.5 518.5L91.0152 533.583L99.8197 518.667L82.5 518.5ZM83.9193 521.08L85.2111 521.842L86.7361 519.259L85.4443 518.496L83.9193 521.08ZM89.8079 521.072L88.5162 520.309L86.9912 522.893L88.283 523.655L89.8079 521.072ZM92.6466 526.231L93.9383 526.994L95.4633 524.41L94.1716 523.648L92.6466 526.231ZM98.5352 526.223L97.2435 525.461L95.7185 528.044L97.0102 528.807L98.5352 526.223ZM101.374 531.383L102.666 532.145L104.191 529.562L102.899 528.799L101.374 531.383ZM107.262 531.375L105.971 530.612L104.446 533.196L105.738 533.958L107.262 531.375ZM110.101 536.534L111.393 537.297L112.918 534.713L111.626 533.951L110.101 536.534ZM115.99 536.526L114.698 535.764L113.173 538.347L114.465 539.11L115.99 536.526ZM118.828 541.686L120.12 542.448L121.645 539.865L120.353 539.102L118.828 541.686ZM124.717 541.678L123.425 540.915L121.9 543.499L123.192 544.261L124.717 541.678ZM127.556 546.837L128.847 547.6L130.372 545.016L129.081 544.254L127.556 546.837ZM133.444 546.829L132.153 546.067L130.628 548.65L131.919 549.413L133.444 546.829ZM136.283 551.989L137.575 552.751L139.1 550.168L137.808 549.405L136.283 551.989ZM142.172 551.981L140.88 551.218L139.355 553.802L140.647 554.564L142.172 551.981ZM145.01 557.14L146.302 557.903L147.827 555.319L146.535 554.557L145.01 557.14ZM150.899 557.132L149.607 556.37L148.082 558.954L149.374 559.716L150.899 557.132ZM153.738 562.292L155.029 563.054L156.554 560.471L155.262 559.708L153.738 562.292ZM159.626 562.284L158.334 561.522L156.809 564.105L158.101 564.868L159.626 562.284ZM162.465 567.443L163.757 568.206L165.282 565.622L163.99 564.86L162.465 567.443ZM168.353 567.436L167.062 566.673L165.537 569.257L166.828 570.019L168.353 567.436ZM171.192 572.595L172.484 573.357L174.009 570.774L172.717 570.011L171.192 572.595ZM177.081 572.587L175.789 571.825L174.264 574.408L175.556 575.171L177.081 572.587ZM179.919 577.746L181.211 578.509L182.736 575.925L181.444 575.163L179.919 577.746ZM185.808 577.739L184.516 576.976L182.991 579.56L184.283 580.322L185.808 577.739ZM188.647 582.898L189.938 583.66L191.463 581.077L190.172 580.314L188.647 582.898ZM194.535 582.89L193.243 582.128L191.718 584.711L193.01 585.474L194.535 582.89ZM197.374 588.049L198.666 588.812L200.191 586.228L198.899 585.466L197.374 588.049ZM203.262 588.042L201.971 587.279L200.446 589.863L201.737 590.625L203.262 588.042ZM206.101 593.201L207.393 593.963L208.918 591.38L207.626 590.617L206.101 593.201ZM211.99 593.193L210.698 592.431L209.173 595.014L210.465 595.777L211.99 593.193ZM214.828 598.352L216.12 599.115L217.645 596.531L216.353 595.769L214.828 598.352ZM220.717 598.345L219.425 597.582L217.9 600.166L219.192 600.928L220.717 598.345ZM223.556 603.504L224.847 604.266L226.372 601.683L225.081 600.92L223.556 603.504ZM88.283 523.655L92.6466 526.231L94.1716 523.648L89.8079 521.072L88.283 523.655ZM97.0102 528.807L101.374 531.383L102.899 528.799L98.5352 526.223L97.0102 528.807ZM105.738 533.958L110.101 536.534L111.626 533.951L107.262 531.375L105.738 533.958ZM114.465 539.11L118.828 541.686L120.353 539.102L115.99 536.526L114.465 539.11ZM123.192 544.261L127.556 546.837L129.081 544.254L124.717 541.678L123.192 544.261ZM131.919 549.413L136.283 551.989L137.808 549.405L133.444 546.829L131.919 549.413ZM140.647 554.564L145.01 557.14L146.535 554.557L142.172 551.981L140.647 554.564ZM149.374 559.716L153.738 562.292L155.262 559.708L150.899 557.132L149.374 559.716ZM158.101 564.868L162.465 567.443L163.99 564.86L159.626 562.284L158.101 564.868ZM166.828 570.019L171.192 572.595L172.717 570.011L168.353 567.436L166.828 570.019ZM175.556 575.171L179.919 577.746L181.444 575.163L177.081 572.587L175.556 575.171ZM184.283 580.322L188.647 582.898L190.172 580.314L185.808 577.739L184.283 580.322ZM193.01 585.474L197.374 588.049L198.899 585.466L194.535 582.89L193.01 585.474ZM201.737 590.625L206.101 593.201L207.626 590.617L203.262 588.042L201.737 590.625ZM210.465 595.777L214.828 598.352L216.353 595.769L211.99 593.193L210.465 595.777ZM219.192 600.928L223.556 603.504L225.081 600.92L220.717 598.345L219.192 600.928Z" fill="black"/>
<path d="M373.5 518.5L356.179 518.511L364.85 533.506L373.5 518.5ZM226.5 603.5L243.821 603.489L235.15 588.494L226.5 603.5ZM229.413 603.549L230.711 602.798L229.209 600.201L227.911 600.951L229.413 603.549ZM232.234 598.451L230.936 599.202L232.438 601.799L233.736 601.049L232.234 598.451ZM238.06 598.549L239.358 597.798L237.857 595.201L236.558 595.951L238.06 598.549ZM240.881 593.451L239.583 594.202L241.085 596.799L242.383 596.049L240.881 593.451ZM246.707 593.549L248.005 592.798L246.504 590.201L245.205 590.951L246.707 593.549ZM249.529 588.451L248.23 589.202L249.732 591.799L251.03 591.049L249.529 588.451ZM255.354 588.549L256.652 587.798L255.151 585.201L253.852 585.951L255.354 588.549ZM258.176 583.451L256.877 584.202L258.379 586.799L259.677 586.049L258.176 583.451ZM264.001 583.549L265.299 582.798L263.798 580.201L262.499 580.951L264.001 583.549ZM266.823 578.451L265.524 579.202L267.026 581.799L268.324 581.049L266.823 578.451ZM272.648 578.549L273.946 577.798L272.445 575.201L271.146 575.951L272.648 578.549ZM275.47 573.451L274.171 574.202L275.673 576.799L276.971 576.049L275.47 573.451ZM281.295 573.549L282.594 572.798L281.092 570.201L279.793 570.951L281.295 573.549ZM284.117 568.451L282.818 569.202L284.32 571.799L285.618 571.049L284.117 568.451ZM289.942 568.549L291.241 567.798L289.739 565.201L288.44 565.951L289.942 568.549ZM292.764 563.451L291.465 564.202L292.967 566.799L294.266 566.049L292.764 563.451ZM298.589 563.549L299.888 562.798L298.386 560.201L297.087 560.951L298.589 563.549ZM301.411 558.451L300.112 559.202L301.614 561.799L302.913 561.049L301.411 558.451ZM307.236 558.549L308.535 557.798L307.033 555.201L305.734 555.951L307.236 558.549ZM310.058 553.451L308.759 554.202L310.261 556.799L311.56 556.049L310.058 553.451ZM315.883 553.549L317.182 552.798L315.68 550.201L314.381 550.951L315.883 553.549ZM318.705 548.451L317.406 549.202L318.908 551.799L320.207 551.049L318.705 548.451ZM324.53 548.549L325.829 547.798L324.327 545.201L323.029 545.951L324.53 548.549ZM327.352 543.451L326.054 544.202L327.555 546.799L328.854 546.049L327.352 543.451ZM333.177 543.549L334.476 542.798L332.974 540.201L331.676 540.951L333.177 543.549ZM335.999 538.451L334.701 539.202L336.202 541.799L337.501 541.049L335.999 538.451ZM341.824 538.549L343.123 537.798L341.621 535.201L340.323 535.951L341.824 538.549ZM344.646 533.451L343.348 534.202L344.849 536.799L346.148 536.049L344.646 533.451ZM350.471 533.549L351.77 532.798L350.268 530.201L348.97 530.951L350.471 533.549ZM353.293 528.451L351.995 529.202L353.496 531.799L354.795 531.049L353.293 528.451ZM359.118 528.549L360.417 527.798L358.915 525.201L357.617 525.951L359.118 528.549ZM361.94 523.451L360.642 524.202L362.143 526.799L363.442 526.049L361.94 523.451ZM367.766 523.549L369.064 522.798L367.562 520.201L366.264 520.951L367.766 523.549ZM370.587 518.451L369.289 519.202L370.791 521.799L372.089 521.049L370.587 518.451ZM233.736 601.049L238.06 598.549L236.558 595.951L232.234 598.451L233.736 601.049ZM242.383 596.049L246.707 593.549L245.205 590.951L240.881 593.451L242.383 596.049ZM251.03 591.049L255.354 588.549L253.852 585.951L249.529 588.451L251.03 591.049ZM259.677 586.049L264.001 583.549L262.499 580.951L258.176 583.451L259.677 586.049ZM268.324 581.049L272.648 578.549L271.146 575.951L266.823 578.451L268.324 581.049ZM276.971 576.049L281.295 573.549L279.793 570.951L275.47 573.451L276.971 576.049ZM285.618 571.049L289.942 568.549L288.44 565.951L284.117 568.451L285.618 571.049ZM294.266 566.049L298.589 563.549L297.087 560.951L292.764 563.451L294.266 566.049ZM302.913 561.049L307.236 558.549L305.734 555.951L301.411 558.451L302.913 561.049ZM311.56 556.049L315.883 553.549L314.381 550.951L310.058 553.451L311.56 556.049ZM320.207 551.049L324.53 548.549L323.029 545.951L318.705 548.451L320.207 551.049ZM328.854 546.049L333.177 543.549L331.676 540.951L327.352 543.451L328.854 546.049ZM337.501 541.049L341.824 538.549L340.323 535.951L335.999 538.451L337.501 541.049ZM346.148 536.049L350.471 533.549L348.97 530.951L344.646 533.451L346.148 536.049ZM354.795 531.049L359.118 528.549L357.617 525.951L353.293 528.451L354.795 531.049ZM363.442 526.049L367.766 523.549L366.264 520.951L361.94 523.451L363.442 526.049Z" fill="black"/>
<path d="M164.5 470.5L179.5 479.16V461.84L164.5 470.5ZM167.04 472H168.54V469H167.04V472ZM172.12 469H170.62V472H172.12V469ZM177.2 472H178.7V469H177.2V472ZM182.28 469H180.78V472H182.28V469ZM187.36 472H188.86V469H187.36V472ZM192.44 469H190.94V472H192.44V469ZM197.52 472H199.02V469H197.52V472ZM202.6 469H201.1V472H202.6V469ZM207.68 472H209.18V469H207.68V472ZM212.76 469H211.26V472H212.76V469ZM217.84 472H219.34V469H217.84V472ZM222.92 469H221.42V472H222.92V469ZM228 472H229.5V469H228V472ZM233.08 469H231.58V472H233.08V469ZM238.16 472H239.66V469H238.16V472ZM243.24 469H241.74V472H243.24V469ZM248.32 472H249.82V469H248.32V472ZM253.4 469H251.9V472H253.4V469ZM258.48 472H259.98V469H258.48V472ZM263.56 469H262.06V472H263.56V469ZM268.64 472H270.14V469H268.64V472ZM273.72 469H272.22V472H273.72V469ZM278.8 472H280.3V469H278.8V472ZM283.88 469H282.38V472H283.88V469ZM288.96 472H290.46V469H288.96V472ZM172.12 472H177.2V469H172.12V472ZM182.28 472H187.36V469H182.28V472ZM192.44 472H197.52V469H192.44V472ZM202.6 472H207.68V469H202.6V472ZM212.76 472H217.84V469H212.76V472ZM222.92 472H228V469H222.92V472ZM233.08 472H238.16V469H233.08V472ZM243.24 472H248.32V469H243.24V472ZM253.4 472H258.48V469H253.4V472ZM263.56 472H268.64V469H263.56V472ZM273.72 472H278.8V469H273.72V472ZM283.88 472H288.96V469H283.88V472Z" fill="#435B67"/>
<path d="M164.5 470.5L179.5 479.16V461.84L164.5 470.5ZM167.04 472H168.54V469H167.04V472ZM172.12 469H170.62V472H172.12V469ZM177.2 472H178.7V469H177.2V472ZM182.28 469H180.78V472H182.28V469ZM187.36 472H188.86V469H187.36V472ZM192.44 469H190.94V472H192.44V469ZM197.52 472H199.02V469H197.52V472ZM202.6 469H201.1V472H202.6V469ZM207.68 472H209.18V469H207.68V472ZM212.76 469H211.26V472H212.76V469ZM217.84 472H219.34V469H217.84V472ZM222.92 469H221.42V472H222.92V469ZM228 472H229.5V469H228V472ZM233.08 469H231.58V472H233.08V469ZM238.16 472H239.66V469H238.16V472ZM243.24 469H241.74V472H243.24V469ZM248.32 472H249.82V469H248.32V472ZM253.4 469H251.9V472H253.4V469ZM258.48 472H259.98V469H258.48V472ZM263.56 469H262.06V472H263.56V469ZM268.64 472H270.14V469H268.64V472ZM273.72 469H272.22V472H273.72V469ZM278.8 472H280.3V469H278.8V472ZM283.88 469H282.38V472H283.88V469ZM288.96 472H290.46V469H288.96V472ZM172.12 472H177.2V469H172.12V472ZM182.28 472H187.36V469H182.28V472ZM192.44 472H197.52V469H192.44V472ZM202.6 472H207.68V469H202.6V472ZM212.76 472H217.84V469H212.76V472ZM222.92 472H228V469H222.92V472ZM233.08 472H238.16V469H233.08V472ZM243.24 472H248.32V469H243.24V472ZM253.4 472H258.48V469H253.4V472ZM263.56 472H268.64V469H263.56V472ZM273.72 472H278.8V469H273.72V472ZM283.88 472H288.96V469H283.88V472Z" fill="black"/>
<path d="M82.5 288.5L73.8397 303.5H91.1603L82.5 288.5ZM81 290.981V292.481H84V290.981H81ZM84 295.944V294.444H81V295.944H84ZM81 300.907V302.407H84V300.907H81ZM84 305.87V304.37H81V305.87H84ZM81 310.833V312.333H84V310.833H81ZM84 315.796V314.296H81V315.796H84ZM81 320.759V322.259H84V320.759H81ZM84 325.722V324.222H81V325.722H84ZM81 330.685V332.185H84V330.685H81ZM84 335.648V334.148H81V335.648H84ZM81 340.611V342.111H84V340.611H81ZM84 345.574V344.074H81V345.574H84ZM81 350.537V352.037H84V350.537H81ZM84 355.5V354H81V355.5H84ZM81 360.463V361.963H84V360.463H81ZM84 365.426V363.926H81V365.426H84ZM81 370.389V371.889H84V370.389H81ZM84 375.352V373.852H81V375.352H84ZM81 380.315V381.815H84V380.315H81ZM84 385.278V383.778H81V385.278H84ZM81 390.241V391.741H84V390.241H81ZM84 395.204V393.704H81V395.204H84ZM81 400.167V401.667H84V400.167H81ZM84 405.13V403.63H81V405.13H84ZM81 410.093V411.593H84V410.093H81ZM84 415.056V413.556H81V415.056H84ZM81 420.019V421.519H84V420.019H81ZM81 295.944V300.907H84V295.944H81ZM81 305.87V310.833H84V305.87H81ZM81 315.796V320.759H84V315.796H81ZM81 325.722V330.685H84V325.722H81ZM81 335.648V340.611H84V335.648H81ZM81 345.574V350.537H84V345.574H81ZM81 355.5V360.463H84V355.5H81ZM81 365.426V370.389H84V365.426H81ZM81 375.352V380.315H84V375.352H81ZM81 385.278V390.241H84V385.278H81ZM81 395.204V400.167H84V395.204H81ZM81 405.13V410.093H84V405.13H81ZM81 415.056V420.019H84V415.056H81Z" fill="black"/>
<path d="M83.5 422L100.747 423.594L93.5042 407.861L83.5 422ZM373.5 288.5L356.253 286.906L363.496 302.639L373.5 288.5ZM86.3929 422.32L87.7554 421.692L86.5009 418.967L85.1384 419.594L86.3929 422.32ZM89.6696 417.509L88.3071 418.136L89.5616 420.861L90.9241 420.234L89.6696 417.509ZM95.4554 418.148L96.8179 417.52L95.5634 414.795L94.2009 415.423L95.4554 418.148ZM98.7321 413.337L97.3696 413.964L98.6241 416.689L99.9866 416.062L98.7321 413.337ZM104.518 413.976L105.88 413.349L104.626 410.623L103.263 411.251L104.518 413.976ZM107.795 409.165L106.432 409.792L107.687 412.517L109.049 411.89L107.795 409.165ZM113.58 409.804L114.943 409.177L113.688 406.452L112.326 407.079L113.58 409.804ZM116.857 404.993L115.495 405.62L116.749 408.345L118.112 407.718L116.857 404.993ZM122.643 405.632L124.005 405.005L122.751 402.28L121.388 402.907L122.643 405.632ZM125.92 400.821L124.557 401.448L125.812 404.173L127.174 403.546L125.92 400.821ZM131.705 401.46L133.068 400.833L131.813 398.108L130.451 398.735L131.705 401.46ZM134.982 396.649L133.62 397.276L134.874 400.002L136.237 399.374L134.982 396.649ZM140.768 397.288L142.13 396.661L140.876 393.936L139.513 394.563L140.768 397.288ZM144.045 392.477L142.682 393.105L143.937 395.83L145.299 395.202L144.045 392.477ZM149.83 393.116L151.193 392.489L149.938 389.764L148.576 390.391L149.83 393.116ZM153.107 388.305L151.745 388.933L152.999 391.658L154.362 391.031L153.107 388.305ZM158.893 388.945L160.255 388.317L159.001 385.592L157.638 386.219L158.893 388.945ZM162.17 384.134L160.807 384.761L162.062 387.486L163.424 386.859L162.17 384.134ZM167.955 384.773L169.318 384.145L168.063 381.42L166.701 382.048L167.955 384.773ZM171.232 379.962L169.87 380.589L171.124 383.314L172.487 382.687L171.232 379.962ZM177.018 380.601L178.38 379.974L177.126 377.248L175.763 377.876L177.018 380.601ZM180.295 375.79L178.932 376.417L180.187 379.142L181.549 378.515L180.295 375.79ZM186.08 376.429L187.443 375.802L186.188 373.077L184.826 373.704L186.08 376.429ZM189.357 371.618L187.995 372.245L189.249 374.97L190.612 374.343L189.357 371.618ZM195.143 372.257L196.505 371.63L195.251 368.905L193.888 369.532L195.143 372.257ZM198.42 367.446L197.057 368.073L198.312 370.798L199.674 370.171L198.42 367.446ZM204.205 368.085L205.568 367.458L204.313 364.733L202.951 365.36L204.205 368.085ZM207.482 363.274L206.12 363.901L207.374 366.627L208.737 365.999L207.482 363.274ZM213.268 363.913L214.63 363.286L213.376 360.561L212.013 361.188L213.268 363.913ZM216.545 359.102L215.182 359.73L216.437 362.455L217.799 361.827L216.545 359.102ZM222.33 359.741L223.693 359.114L222.438 356.389L221.076 357.016L222.33 359.741ZM225.607 354.93L224.245 355.558L225.499 358.283L226.862 357.656L225.607 354.93ZM231.393 355.57L232.755 354.942L231.501 352.217L230.138 352.844L231.393 355.57ZM234.67 350.759L233.307 351.386L234.562 354.111L235.924 353.484L234.67 350.759ZM240.455 351.398L241.818 350.77L240.563 348.045L239.201 348.673L240.455 351.398ZM243.732 346.587L242.37 347.214L243.624 349.939L244.987 349.312L243.732 346.587ZM249.518 347.226L250.88 346.599L249.626 343.873L248.263 344.501L249.518 347.226ZM252.795 342.415L251.432 343.042L252.687 345.767L254.049 345.14L252.795 342.415ZM258.58 343.054L259.943 342.427L258.688 339.702L257.326 340.329L258.58 343.054ZM261.857 338.243L260.495 338.87L261.749 341.595L263.112 340.968L261.857 338.243ZM267.643 338.882L269.005 338.255L267.751 335.53L266.388 336.157L267.643 338.882ZM270.92 334.071L269.557 334.698L270.812 337.423L272.174 336.796L270.92 334.071ZM276.705 334.71L278.068 334.083L276.813 331.358L275.451 331.985L276.705 334.71ZM279.982 329.899L278.62 330.526L279.874 333.252L281.237 332.624L279.982 329.899ZM285.768 330.538L287.13 329.911L285.876 327.186L284.513 327.813L285.768 330.538ZM289.045 325.727L287.682 326.355L288.937 329.08L290.299 328.452L289.045 325.727ZM294.83 326.366L296.193 325.739L294.938 323.014L293.576 323.641L294.83 326.366ZM298.107 321.555L296.745 322.183L297.999 324.908L299.362 324.281L298.107 321.555ZM303.893 322.195L305.255 321.567L304.001 318.842L302.638 319.469L303.893 322.195ZM307.17 317.384L305.807 318.011L307.062 320.736L308.424 320.109L307.17 317.384ZM312.955 318.023L314.318 317.395L313.064 314.67L311.701 315.298L312.955 318.023ZM316.232 313.212L314.87 313.839L316.124 316.564L317.487 315.937L316.232 313.212ZM322.018 313.851L323.38 313.224L322.126 310.498L320.763 311.126L322.018 313.851ZM325.295 309.04L323.932 309.667L325.187 312.392L326.549 311.765L325.295 309.04ZM331.08 309.679L332.443 309.052L331.188 306.327L329.826 306.954L331.08 309.679ZM334.357 304.868L332.995 305.495L334.249 308.22L335.612 307.593L334.357 304.868ZM340.143 305.507L341.505 304.88L340.251 302.155L338.888 302.782L340.143 305.507ZM343.42 300.696L342.057 301.323L343.312 304.048L344.674 303.421L343.42 300.696ZM349.205 301.335L350.568 300.708L349.313 297.983L347.951 298.61L349.205 301.335ZM352.482 296.524L351.12 297.151L352.374 299.877L353.737 299.249L352.482 296.524ZM358.268 297.163L359.63 296.536L358.376 293.811L357.013 294.438L358.268 297.163ZM361.545 292.352L360.182 292.98L361.437 295.705L362.799 295.077L361.545 292.352ZM367.33 292.991L368.693 292.364L367.438 289.639L366.076 290.266L367.33 292.991ZM370.607 288.18L369.245 288.808L370.499 291.533L371.862 290.906L370.607 288.18ZM90.9241 420.234L95.4554 418.148L94.2009 415.423L89.6696 417.509L90.9241 420.234ZM99.9866 416.062L104.518 413.976L103.263 411.251L98.7321 413.337L99.9866 416.062ZM109.049 411.89L113.58 409.804L112.326 407.079L107.795 409.165L109.049 411.89ZM118.112 407.718L122.643 405.632L121.388 402.907L116.857 404.993L118.112 407.718ZM127.174 403.546L131.705 401.46L130.451 398.735L125.92 400.821L127.174 403.546ZM136.237 399.374L140.768 397.288L139.513 394.563L134.982 396.649L136.237 399.374ZM145.299 395.202L149.83 393.116L148.576 390.391L144.045 392.477L145.299 395.202ZM154.362 391.031L158.893 388.945L157.638 386.219L153.107 388.305L154.362 391.031ZM163.424 386.859L167.955 384.773L166.701 382.048L162.17 384.134L163.424 386.859ZM172.487 382.687L177.018 380.601L175.763 377.876L171.232 379.962L172.487 382.687ZM181.549 378.515L186.08 376.429L184.826 373.704L180.295 375.79L181.549 378.515ZM190.612 374.343L195.143 372.257L193.888 369.532L189.357 371.618L190.612 374.343ZM199.674 370.171L204.205 368.085L202.951 365.36L198.42 367.446L199.674 370.171ZM208.737 365.999L213.268 363.913L212.013 361.188L207.482 363.274L208.737 365.999ZM217.799 361.827L222.33 359.741L221.076 357.016L216.545 359.102L217.799 361.827ZM226.862 357.656L231.393 355.57L230.138 352.844L225.607 354.93L226.862 357.656ZM235.924 353.484L240.455 351.398L239.201 348.673L234.67 350.759L235.924 353.484ZM244.987 349.312L249.518 347.226L248.263 344.501L243.732 346.587L244.987 349.312ZM254.049 345.14L258.58 343.054L257.326 340.329L252.795 342.415L254.049 345.14ZM263.112 340.968L267.643 338.882L266.388 336.157L261.857 338.243L263.112 340.968ZM272.174 336.796L276.705 334.71L275.451 331.985L270.92 334.071L272.174 336.796ZM281.237 332.624L285.768 330.538L284.513 327.813L279.982 329.899L281.237 332.624ZM290.299 328.452L294.83 326.366L293.576 323.641L289.045 325.727L290.299 328.452ZM299.362 324.281L303.893 322.195L302.638 319.469L298.107 321.555L299.362 324.281ZM308.424 320.109L312.955 318.023L311.701 315.298L307.17 317.384L308.424 320.109ZM317.487 315.937L322.018 313.851L320.763 311.126L316.232 313.212L317.487 315.937ZM326.549 311.765L331.08 309.679L329.826 306.954L325.295 309.04L326.549 311.765ZM335.612 307.593L340.143 305.507L338.888 302.782L334.357 304.868L335.612 307.593ZM344.674 303.421L349.205 301.335L347.951 298.61L343.42 300.696L344.674 303.421ZM353.737 299.249L358.268 297.163L357.013 294.438L352.482 296.524L353.737 299.249ZM362.799 295.077L367.33 292.991L366.076 290.266L361.545 292.352L362.799 295.077Z" fill="black"/>
<path d="M83.5 192.5L92.1603 177.5H74.8397L83.5 192.5ZM83.5 58.5L74.8397 73.5H92.1603L83.5 58.5ZM85 179V72H82V179H85Z" fill="black"/>
<path d="M373.5 192.5L382.16 177.5H364.84L373.5 192.5ZM373.5 58.5L364.84 73.5H382.16L373.5 58.5ZM375 179V72H372V179H375Z" fill="black"/>
<path d="M811.5 285.5L820.16 270.5H802.84L811.5 285.5ZM811.5 168.5L802.84 183.5H820.16L811.5 168.5ZM813 272V182H810V272H813Z" fill="black"/>
<path d="M811.75 500.25L820.252 485.16L802.932 485.342L811.75 500.25ZM810.5 381.5L801.998 396.59L819.318 396.408L810.5 381.5ZM813.108 486.735L812.142 394.983L809.142 395.015L810.108 486.767L813.108 486.735Z" fill="black"/>
<path d="M892 120L891.655 137.317L906.825 128.957L892 120ZM892 546L906.825 537.043L891.655 528.683L892 546ZM897.189 132.522C913.307 163.066 953.686 248.089 953.686 333H956.686C956.686 247.313 915.999 161.738 899.842 131.121L897.189 132.522ZM953.686 333C953.686 417.911 913.307 502.934 897.189 533.478L899.842 534.879C915.999 504.262 956.686 418.687 956.686 333H953.686Z" fill="black"/>
<path d="M728 120L708.602 107.469L707.448 130.534L728 120ZM122.479 193.347C132.522 182.319 147.736 172.762 167.019 164.527C186.282 156.301 209.48 149.447 235.365 143.76C287.137 132.387 349.464 125.723 412.153 122.015C537.518 114.6 664.062 119.019 709.919 121.099L710.1 117.103C664.197 115.021 537.49 110.595 411.916 118.022C349.135 121.736 286.572 128.415 234.507 139.853C208.474 145.573 185.017 152.492 165.448 160.849C145.899 169.197 130.104 179.033 119.521 190.653L122.479 193.347Z" fill="#FF2E55"/>
<path d="M728 119.929L709.104 106.652L707.054 129.655L728 119.929ZM418.809 192.035C428.545 171.387 447.643 156.204 472.061 145.147C496.47 134.093 526.003 127.251 556.275 123.185C616.814 115.052 679.905 118.064 709.917 120.325L710.218 116.337C680.11 114.068 616.694 111.032 555.743 119.22C525.27 123.314 495.312 130.226 470.41 141.503C445.516 152.776 425.483 168.503 415.191 190.329L418.809 192.035Z" fill="#FF2E55"/>
</svg>
</div>

To achieve exactly once connectivity with resilience, we can use locks on key-value-pairs in Consul (or znodes in Zookeeper). At start have the API gateways receive a list of connections to open. Then, each connection is mapped to a key-value pair, and the API gateways compete to take out the locks on each key-value-pair. When a node has obtained the lock, it is free to open the outbound connectivity. Similarly, when the node does not have the lock, it cannot open the connection.

To introduce resilience against a failed API Gateway process, lock timeouts and regular keep-alive requests are made from each API Gateway. The moment a lock is freed, all other connected API Gateways will be able to again try claim the lock, and then reopen connectivity.

If processes start minutes apart, the first node to start will likely get the majority of work.

## Approach 2: Build the logic into the Aeron Cluster service container

<div align="center">
<svg width="auto" height="600" viewBox="0 0 455 699" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect y="192" width="164" height="96" rx="4" fill="#5AC8FA"/>
<rect x="291" y="192" width="164" height="96" rx="4" fill="#5AC8FA"/>
<rect y="422" width="164" height="96" rx="4" fill="#2ACC41"/>
<rect x="291" y="422" width="164" height="96" rx="4" fill="#2ACC41"/>
<rect x="146" y="603" width="164" height="96" rx="4" fill="#2ACC41"/>
<rect width="455" height="58" rx="4" fill="#FFCC02"/>
<text fill="black" xml:space="preserve" font-family="-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, sans-serif" font-size="21" letter-spacing="0px"><tspan x="155" y="36.472">Remote System</tspan></text>
<text fill="black" xml:space="preserve" font-family="-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, sans-serif" font-size="21" letter-spacing="0px"><tspan x="66.3115" y="229.472">API&#10;</tspan><tspan x="33.2734" y="254.472">Gateway 1</tspan></text>
<text fill="black" xml:space="preserve" font-family="-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, sans-serif" font-size="21" letter-spacing="0px"><tspan x="49.6235" y="454.472">Cluster&#10;</tspan><tspan x="50.813" y="479.472">Leader</tspan></text>
<text fill="black" xml:space="preserve" font-family="-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, sans-serif" font-size="21" letter-spacing="0px"><tspan x="339.624" y="459.472">Cluster&#10;</tspan><tspan x="324.109" y="484.472">Follower 1</tspan></text>
<text fill="black" xml:space="preserve" font-family="-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, sans-serif" font-size="21" letter-spacing="0px"><tspan x="194.624" y="640.472">Cluster&#10;</tspan><tspan x="179.109" y="665.472">Follower 2</tspan></text>
<text fill="black" xml:space="preserve" font-family="-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, sans-serif" font-size="21" letter-spacing="0px"><tspan x="357.312" y="229.472">API&#10;</tspan><tspan x="324.273" y="254.472">Gateway 2</tspan></text>
<path d="M82.5 518.5L91.0152 533.583L99.8197 518.667L82.5 518.5ZM83.9193 521.08L85.2111 521.842L86.7361 519.259L85.4443 518.496L83.9193 521.08ZM89.8079 521.072L88.5162 520.309L86.9912 522.893L88.283 523.655L89.8079 521.072ZM92.6466 526.231L93.9383 526.994L95.4633 524.41L94.1716 523.648L92.6466 526.231ZM98.5352 526.223L97.2435 525.461L95.7185 528.044L97.0102 528.807L98.5352 526.223ZM101.374 531.383L102.666 532.145L104.191 529.562L102.899 528.799L101.374 531.383ZM107.262 531.375L105.971 530.612L104.446 533.196L105.738 533.958L107.262 531.375ZM110.101 536.534L111.393 537.297L112.918 534.713L111.626 533.951L110.101 536.534ZM115.99 536.526L114.698 535.764L113.173 538.347L114.465 539.11L115.99 536.526ZM118.828 541.686L120.12 542.448L121.645 539.865L120.353 539.102L118.828 541.686ZM124.717 541.678L123.425 540.915L121.9 543.499L123.192 544.261L124.717 541.678ZM127.556 546.837L128.847 547.6L130.372 545.016L129.081 544.254L127.556 546.837ZM133.444 546.829L132.153 546.067L130.628 548.65L131.919 549.413L133.444 546.829ZM136.283 551.989L137.575 552.751L139.1 550.168L137.808 549.405L136.283 551.989ZM142.172 551.981L140.88 551.218L139.355 553.802L140.647 554.564L142.172 551.981ZM145.01 557.14L146.302 557.903L147.827 555.319L146.535 554.557L145.01 557.14ZM150.899 557.132L149.607 556.37L148.082 558.954L149.374 559.716L150.899 557.132ZM153.738 562.292L155.029 563.054L156.554 560.471L155.262 559.708L153.738 562.292ZM159.626 562.284L158.334 561.522L156.809 564.105L158.101 564.868L159.626 562.284ZM162.465 567.443L163.757 568.206L165.282 565.622L163.99 564.86L162.465 567.443ZM168.353 567.436L167.062 566.673L165.537 569.257L166.828 570.019L168.353 567.436ZM171.192 572.595L172.484 573.357L174.009 570.774L172.717 570.011L171.192 572.595ZM177.081 572.587L175.789 571.825L174.264 574.408L175.556 575.171L177.081 572.587ZM179.919 577.746L181.211 578.509L182.736 575.925L181.444 575.163L179.919 577.746ZM185.808 577.739L184.516 576.976L182.991 579.56L184.283 580.322L185.808 577.739ZM188.647 582.898L189.938 583.66L191.463 581.077L190.172 580.314L188.647 582.898ZM194.535 582.89L193.243 582.128L191.718 584.711L193.01 585.474L194.535 582.89ZM197.374 588.049L198.666 588.812L200.191 586.228L198.899 585.466L197.374 588.049ZM203.262 588.042L201.971 587.279L200.446 589.863L201.737 590.625L203.262 588.042ZM206.101 593.201L207.393 593.963L208.918 591.38L207.626 590.617L206.101 593.201ZM211.99 593.193L210.698 592.431L209.173 595.014L210.465 595.777L211.99 593.193ZM214.828 598.352L216.12 599.115L217.645 596.531L216.353 595.769L214.828 598.352ZM220.717 598.345L219.425 597.582L217.9 600.166L219.192 600.928L220.717 598.345ZM223.556 603.504L224.847 604.266L226.372 601.683L225.081 600.92L223.556 603.504ZM88.283 523.655L92.6466 526.231L94.1716 523.648L89.8079 521.072L88.283 523.655ZM97.0102 528.807L101.374 531.383L102.899 528.799L98.5352 526.223L97.0102 528.807ZM105.738 533.958L110.101 536.534L111.626 533.951L107.262 531.375L105.738 533.958ZM114.465 539.11L118.828 541.686L120.353 539.102L115.99 536.526L114.465 539.11ZM123.192 544.261L127.556 546.837L129.081 544.254L124.717 541.678L123.192 544.261ZM131.919 549.413L136.283 551.989L137.808 549.405L133.444 546.829L131.919 549.413ZM140.647 554.564L145.01 557.14L146.535 554.557L142.172 551.981L140.647 554.564ZM149.374 559.716L153.738 562.292L155.262 559.708L150.899 557.132L149.374 559.716ZM158.101 564.868L162.465 567.443L163.99 564.86L159.626 562.284L158.101 564.868ZM166.828 570.019L171.192 572.595L172.717 570.011L168.353 567.436L166.828 570.019ZM175.556 575.171L179.919 577.746L181.444 575.163L177.081 572.587L175.556 575.171ZM184.283 580.322L188.647 582.898L190.172 580.314L185.808 577.739L184.283 580.322ZM193.01 585.474L197.374 588.049L198.899 585.466L194.535 582.89L193.01 585.474ZM201.737 590.625L206.101 593.201L207.626 590.617L203.262 588.042L201.737 590.625ZM210.465 595.777L214.828 598.352L216.353 595.769L211.99 593.193L210.465 595.777ZM219.192 600.928L223.556 603.504L225.081 600.92L220.717 598.345L219.192 600.928Z" fill="black"/>
<path d="M373.5 518.5L356.179 518.511L364.85 533.506L373.5 518.5ZM226.5 603.5L243.821 603.489L235.15 588.494L226.5 603.5ZM229.413 603.549L230.711 602.798L229.209 600.201L227.911 600.951L229.413 603.549ZM232.234 598.451L230.936 599.202L232.438 601.799L233.736 601.049L232.234 598.451ZM238.06 598.549L239.358 597.798L237.857 595.201L236.558 595.951L238.06 598.549ZM240.881 593.451L239.583 594.202L241.085 596.799L242.383 596.049L240.881 593.451ZM246.707 593.549L248.005 592.798L246.504 590.201L245.205 590.951L246.707 593.549ZM249.529 588.451L248.23 589.202L249.732 591.799L251.03 591.049L249.529 588.451ZM255.354 588.549L256.652 587.798L255.151 585.201L253.852 585.951L255.354 588.549ZM258.176 583.451L256.877 584.202L258.379 586.799L259.677 586.049L258.176 583.451ZM264.001 583.549L265.299 582.798L263.798 580.201L262.499 580.951L264.001 583.549ZM266.823 578.451L265.524 579.202L267.026 581.799L268.324 581.049L266.823 578.451ZM272.648 578.549L273.946 577.798L272.445 575.201L271.146 575.951L272.648 578.549ZM275.47 573.451L274.171 574.202L275.673 576.799L276.971 576.049L275.47 573.451ZM281.295 573.549L282.594 572.798L281.092 570.201L279.793 570.951L281.295 573.549ZM284.117 568.451L282.818 569.202L284.32 571.799L285.618 571.049L284.117 568.451ZM289.942 568.549L291.241 567.798L289.739 565.201L288.44 565.951L289.942 568.549ZM292.764 563.451L291.465 564.202L292.967 566.799L294.266 566.049L292.764 563.451ZM298.589 563.549L299.888 562.798L298.386 560.201L297.087 560.951L298.589 563.549ZM301.411 558.451L300.112 559.202L301.614 561.799L302.913 561.049L301.411 558.451ZM307.236 558.549L308.535 557.798L307.033 555.201L305.734 555.951L307.236 558.549ZM310.058 553.451L308.759 554.202L310.261 556.799L311.56 556.049L310.058 553.451ZM315.883 553.549L317.182 552.798L315.68 550.201L314.381 550.951L315.883 553.549ZM318.705 548.451L317.406 549.202L318.908 551.799L320.207 551.049L318.705 548.451ZM324.53 548.549L325.829 547.798L324.327 545.201L323.029 545.951L324.53 548.549ZM327.352 543.451L326.054 544.202L327.555 546.799L328.854 546.049L327.352 543.451ZM333.177 543.549L334.476 542.798L332.974 540.201L331.676 540.951L333.177 543.549ZM335.999 538.451L334.701 539.202L336.202 541.799L337.501 541.049L335.999 538.451ZM341.824 538.549L343.123 537.798L341.621 535.201L340.323 535.951L341.824 538.549ZM344.646 533.451L343.348 534.202L344.849 536.799L346.148 536.049L344.646 533.451ZM350.471 533.549L351.77 532.798L350.268 530.201L348.97 530.951L350.471 533.549ZM353.293 528.451L351.995 529.202L353.496 531.799L354.795 531.049L353.293 528.451ZM359.118 528.549L360.417 527.798L358.915 525.201L357.617 525.951L359.118 528.549ZM361.94 523.451L360.642 524.202L362.143 526.799L363.442 526.049L361.94 523.451ZM367.766 523.549L369.064 522.798L367.562 520.201L366.264 520.951L367.766 523.549ZM370.587 518.451L369.289 519.202L370.791 521.799L372.089 521.049L370.587 518.451ZM233.736 601.049L238.06 598.549L236.558 595.951L232.234 598.451L233.736 601.049ZM242.383 596.049L246.707 593.549L245.205 590.951L240.881 593.451L242.383 596.049ZM251.03 591.049L255.354 588.549L253.852 585.951L249.529 588.451L251.03 591.049ZM259.677 586.049L264.001 583.549L262.499 580.951L258.176 583.451L259.677 586.049ZM268.324 581.049L272.648 578.549L271.146 575.951L266.823 578.451L268.324 581.049ZM276.971 576.049L281.295 573.549L279.793 570.951L275.47 573.451L276.971 576.049ZM285.618 571.049L289.942 568.549L288.44 565.951L284.117 568.451L285.618 571.049ZM294.266 566.049L298.589 563.549L297.087 560.951L292.764 563.451L294.266 566.049ZM302.913 561.049L307.236 558.549L305.734 555.951L301.411 558.451L302.913 561.049ZM311.56 556.049L315.883 553.549L314.381 550.951L310.058 553.451L311.56 556.049ZM320.207 551.049L324.53 548.549L323.029 545.951L318.705 548.451L320.207 551.049ZM328.854 546.049L333.177 543.549L331.676 540.951L327.352 543.451L328.854 546.049ZM337.501 541.049L341.824 538.549L340.323 535.951L335.999 538.451L337.501 541.049ZM346.148 536.049L350.471 533.549L348.97 530.951L344.646 533.451L346.148 536.049ZM354.795 531.049L359.118 528.549L357.617 525.951L353.293 528.451L354.795 531.049ZM363.442 526.049L367.766 523.549L366.264 520.951L361.94 523.451L363.442 526.049Z" fill="black"/>
<path d="M164.5 470.5L179.5 479.16V461.84L164.5 470.5ZM167.04 472H168.54V469H167.04V472ZM172.12 469H170.62V472H172.12V469ZM177.2 472H178.7V469H177.2V472ZM182.28 469H180.78V472H182.28V469ZM187.36 472H188.86V469H187.36V472ZM192.44 469H190.94V472H192.44V469ZM197.52 472H199.02V469H197.52V472ZM202.6 469H201.1V472H202.6V469ZM207.68 472H209.18V469H207.68V472ZM212.76 469H211.26V472H212.76V469ZM217.84 472H219.34V469H217.84V472ZM222.92 469H221.42V472H222.92V469ZM228 472H229.5V469H228V472ZM233.08 469H231.58V472H233.08V469ZM238.16 472H239.66V469H238.16V472ZM243.24 469H241.74V472H243.24V469ZM248.32 472H249.82V469H248.32V472ZM253.4 469H251.9V472H253.4V469ZM258.48 472H259.98V469H258.48V472ZM263.56 469H262.06V472H263.56V469ZM268.64 472H270.14V469H268.64V472ZM273.72 469H272.22V472H273.72V469ZM278.8 472H280.3V469H278.8V472ZM283.88 469H282.38V472H283.88V469ZM288.96 472H290.46V469H288.96V472ZM172.12 472H177.2V469H172.12V472ZM182.28 472H187.36V469H182.28V472ZM192.44 472H197.52V469H192.44V472ZM202.6 472H207.68V469H202.6V472ZM212.76 472H217.84V469H212.76V472ZM222.92 472H228V469H222.92V472ZM233.08 472H238.16V469H233.08V472ZM243.24 472H248.32V469H243.24V472ZM253.4 472H258.48V469H253.4V472ZM263.56 472H268.64V469H263.56V472ZM273.72 472H278.8V469H273.72V472ZM283.88 472H288.96V469H283.88V472Z" fill="#435B67"/>
<path d="M164.5 470.5L179.5 479.16V461.84L164.5 470.5ZM167.04 472H168.54V469H167.04V472ZM172.12 469H170.62V472H172.12V469ZM177.2 472H178.7V469H177.2V472ZM182.28 469H180.78V472H182.28V469ZM187.36 472H188.86V469H187.36V472ZM192.44 469H190.94V472H192.44V469ZM197.52 472H199.02V469H197.52V472ZM202.6 469H201.1V472H202.6V469ZM207.68 472H209.18V469H207.68V472ZM212.76 469H211.26V472H212.76V469ZM217.84 472H219.34V469H217.84V472ZM222.92 469H221.42V472H222.92V469ZM228 472H229.5V469H228V472ZM233.08 469H231.58V472H233.08V469ZM238.16 472H239.66V469H238.16V472ZM243.24 469H241.74V472H243.24V469ZM248.32 472H249.82V469H248.32V472ZM253.4 469H251.9V472H253.4V469ZM258.48 472H259.98V469H258.48V472ZM263.56 469H262.06V472H263.56V469ZM268.64 472H270.14V469H268.64V472ZM273.72 469H272.22V472H273.72V469ZM278.8 472H280.3V469H278.8V472ZM283.88 469H282.38V472H283.88V469ZM288.96 472H290.46V469H288.96V472ZM172.12 472H177.2V469H172.12V472ZM182.28 472H187.36V469H182.28V472ZM192.44 472H197.52V469H192.44V472ZM202.6 472H207.68V469H202.6V472ZM212.76 472H217.84V469H212.76V472ZM222.92 472H228V469H222.92V472ZM233.08 472H238.16V469H233.08V472ZM243.24 472H248.32V469H243.24V472ZM253.4 472H258.48V469H253.4V472ZM263.56 472H268.64V469H263.56V472ZM273.72 472H278.8V469H273.72V472ZM283.88 472H288.96V469H283.88V472Z" fill="black"/>
<path d="M82.5 288.5L73.8397 303.5H91.1603L82.5 288.5ZM81 290.981V292.481H84V290.981H81ZM84 295.944V294.444H81V295.944H84ZM81 300.907V302.407H84V300.907H81ZM84 305.87V304.37H81V305.87H84ZM81 310.833V312.333H84V310.833H81ZM84 315.796V314.296H81V315.796H84ZM81 320.759V322.259H84V320.759H81ZM84 325.722V324.222H81V325.722H84ZM81 330.685V332.185H84V330.685H81ZM84 335.648V334.148H81V335.648H84ZM81 340.611V342.111H84V340.611H81ZM84 345.574V344.074H81V345.574H84ZM81 350.537V352.037H84V350.537H81ZM84 355.5V354H81V355.5H84ZM81 360.463V361.963H84V360.463H81ZM84 365.426V363.926H81V365.426H84ZM81 370.389V371.889H84V370.389H81ZM84 375.352V373.852H81V375.352H84ZM81 380.315V381.815H84V380.315H81ZM84 385.278V383.778H81V385.278H84ZM81 390.241V391.741H84V390.241H81ZM84 395.204V393.704H81V395.204H84ZM81 400.167V401.667H84V400.167H81ZM84 405.13V403.63H81V405.13H84ZM81 410.093V411.593H84V410.093H81ZM84 415.056V413.556H81V415.056H84ZM81 420.019V421.519H84V420.019H81ZM81 295.944V300.907H84V295.944H81ZM81 305.87V310.833H84V305.87H81ZM81 315.796V320.759H84V315.796H81ZM81 325.722V330.685H84V325.722H81ZM81 335.648V340.611H84V335.648H81ZM81 345.574V350.537H84V345.574H81ZM81 355.5V360.463H84V355.5H81ZM81 365.426V370.389H84V365.426H81ZM81 375.352V380.315H84V375.352H81ZM81 385.278V390.241H84V385.278H81ZM81 395.204V400.167H84V395.204H81ZM81 405.13V410.093H84V405.13H81ZM81 415.056V420.019H84V415.056H81Z" fill="black"/>
<path d="M83.5 422.5L100.749 424.07L93.4841 408.347L83.5 422.5ZM373.5 288.5L356.251 286.93L363.516 302.653L373.5 288.5ZM86.3948 422.815L87.7565 422.186L86.4981 419.462L85.1364 420.091L86.3948 422.815ZM89.6677 417.998L88.306 418.627L89.5644 421.35L90.9261 420.721L89.6677 417.998ZM95.4573 418.627L96.819 417.998L95.5606 415.275L94.1989 415.904L95.4573 418.627ZM98.7302 413.81L97.3685 414.439L98.6269 417.163L99.9886 416.534L98.7302 413.81ZM104.52 414.44L105.881 413.811L104.623 411.087L103.261 411.716L104.52 414.44ZM107.793 409.623L106.431 410.252L107.689 412.975L109.051 412.346L107.793 409.623ZM113.582 410.252L114.944 409.623L113.686 406.9L112.324 407.529L113.582 410.252ZM116.855 405.435L115.494 406.064L116.752 408.788L118.114 408.159L116.855 405.435ZM122.645 406.065L124.006 405.436L122.748 402.712L121.386 403.341L122.645 406.065ZM125.918 401.248L124.556 401.877L125.814 404.6L127.176 403.971L125.918 401.248ZM131.707 401.877L133.069 401.248L131.811 398.525L130.449 399.154L131.707 401.877ZM134.98 397.06L133.619 397.689L134.877 400.413L136.239 399.784L134.98 397.06ZM140.77 397.69L142.131 397.061L140.873 394.337L139.511 394.966L140.77 397.69ZM144.043 392.873L142.681 393.502L143.939 396.225L145.301 395.596L144.043 392.873ZM149.832 393.502L151.194 392.873L149.936 390.15L148.574 390.779L149.832 393.502ZM153.105 388.685L151.744 389.314L153.002 392.038L154.364 391.409L153.105 388.685ZM158.895 389.315L160.256 388.686L158.998 385.962L157.636 386.591L158.895 389.315ZM162.168 384.498L160.806 385.127L162.064 387.85L163.426 387.221L162.168 384.498ZM167.957 385.127L169.319 384.498L168.061 381.775L166.699 382.404L167.957 385.127ZM171.23 380.31L169.869 380.939L171.127 383.663L172.489 383.034L171.23 380.31ZM177.02 380.94L178.381 380.311L177.123 377.587L175.761 378.216L177.02 380.94ZM180.293 376.123L178.931 376.752L180.189 379.475L181.551 378.846L180.293 376.123ZM186.082 376.752L187.444 376.123L186.186 373.4L184.824 374.029L186.082 376.752ZM189.355 371.935L187.993 372.564L189.252 375.288L190.614 374.659L189.355 371.935ZM195.145 372.565L196.506 371.936L195.248 369.212L193.886 369.841L195.145 372.565ZM198.418 367.748L197.056 368.377L198.314 371.1L199.676 370.471L198.418 367.748ZM204.207 368.377L205.569 367.748L204.311 365.025L202.949 365.654L204.207 368.377ZM207.48 363.56L206.118 364.189L207.377 366.913L208.739 366.284L207.48 363.56ZM213.27 364.19L214.631 363.561L213.373 360.837L212.011 361.466L213.27 364.19ZM216.543 359.373L215.181 360.002L216.439 362.725L217.801 362.096L216.543 359.373ZM222.332 360.002L223.694 359.373L222.436 356.65L221.074 357.279L222.332 360.002ZM225.605 355.185L224.243 355.814L225.502 358.538L226.864 357.909L225.605 355.185ZM231.395 355.815L232.756 355.186L231.498 352.462L230.136 353.091L231.395 355.815ZM234.668 350.998L233.306 351.627L234.564 354.35L235.926 353.721L234.668 350.998ZM240.457 351.627L241.819 350.998L240.561 348.275L239.199 348.904L240.457 351.627ZM243.73 346.81L242.368 347.439L243.627 350.163L244.989 349.534L243.73 346.81ZM249.52 347.44L250.881 346.811L249.623 344.087L248.261 344.716L249.52 347.44ZM252.793 342.623L251.431 343.252L252.689 345.975L254.051 345.346L252.793 342.623ZM258.582 343.252L259.944 342.623L258.686 339.9L257.324 340.529L258.582 343.252ZM261.855 338.435L260.493 339.064L261.752 341.788L263.114 341.159L261.855 338.435ZM267.645 339.065L269.006 338.436L267.748 335.712L266.386 336.341L267.645 339.065ZM270.918 334.248L269.556 334.877L270.814 337.6L272.176 336.971L270.918 334.248ZM276.707 334.877L278.069 334.248L276.811 331.525L275.449 332.154L276.707 334.877ZM279.98 330.06L278.618 330.689L279.877 333.413L281.239 332.784L279.98 330.06ZM285.77 330.69L287.131 330.061L285.873 327.337L284.511 327.966L285.77 330.69ZM289.043 325.873L287.681 326.502L288.939 329.225L290.301 328.596L289.043 325.873ZM294.832 326.502L296.194 325.873L294.936 323.15L293.574 323.779L294.832 326.502ZM298.105 321.685L296.743 322.314L298.002 325.038L299.363 324.409L298.105 321.685ZM303.895 322.315L305.256 321.686L303.998 318.962L302.636 319.591L303.895 322.315ZM307.168 317.498L305.806 318.127L307.064 320.85L308.426 320.221L307.168 317.498ZM312.957 318.127L314.319 317.498L313.061 314.775L311.699 315.404L312.957 318.127ZM316.23 313.31L314.868 313.939L316.127 316.663L317.489 316.034L316.23 313.31ZM322.02 313.94L323.381 313.311L322.123 310.587L320.761 311.216L322.02 313.94ZM325.293 309.123L323.931 309.752L325.189 312.475L326.551 311.846L325.293 309.123ZM331.082 309.752L332.444 309.123L331.186 306.4L329.824 307.029L331.082 309.752ZM334.355 304.935L332.994 305.564L334.252 308.288L335.614 307.659L334.355 304.935ZM340.145 305.565L341.506 304.936L340.248 302.212L338.886 302.841L340.145 305.565ZM343.418 300.748L342.056 301.377L343.314 304.1L344.676 303.471L343.418 300.748ZM349.207 301.377L350.569 300.748L349.311 298.025L347.949 298.654L349.207 301.377ZM352.48 296.56L351.119 297.189L352.377 299.913L353.739 299.284L352.48 296.56ZM358.27 297.19L359.632 296.561L358.373 293.837L357.012 294.466L358.27 297.19ZM361.543 292.373L360.181 293.002L361.439 295.725L362.801 295.096L361.543 292.373ZM367.332 293.002L368.694 292.373L367.436 289.65L366.074 290.279L367.332 293.002ZM370.605 288.185L369.244 288.814L370.502 291.538L371.864 290.908L370.605 288.185ZM90.9261 420.721L95.4573 418.627L94.1989 415.904L89.6677 417.998L90.9261 420.721ZM99.9886 416.534L104.52 414.44L103.261 411.716L98.7302 413.81L99.9886 416.534ZM109.051 412.346L113.582 410.252L112.324 407.529L107.793 409.623L109.051 412.346ZM118.114 408.159L122.645 406.065L121.386 403.341L116.855 405.435L118.114 408.159ZM127.176 403.971L131.707 401.877L130.449 399.154L125.918 401.248L127.176 403.971ZM136.239 399.784L140.77 397.69L139.511 394.966L134.98 397.06L136.239 399.784ZM145.301 395.596L149.832 393.502L148.574 390.779L144.043 392.873L145.301 395.596ZM154.364 391.409L158.895 389.315L157.636 386.591L153.105 388.685L154.364 391.409ZM163.426 387.221L167.957 385.127L166.699 382.404L162.168 384.498L163.426 387.221ZM172.489 383.034L177.02 380.94L175.761 378.216L171.23 380.31L172.489 383.034ZM181.551 378.846L186.082 376.752L184.824 374.029L180.293 376.123L181.551 378.846ZM190.614 374.659L195.145 372.565L193.886 369.841L189.355 371.935L190.614 374.659ZM199.676 370.471L204.207 368.377L202.949 365.654L198.418 367.748L199.676 370.471ZM208.739 366.284L213.27 364.19L212.011 361.466L207.48 363.56L208.739 366.284ZM217.801 362.096L222.332 360.002L221.074 357.279L216.543 359.373L217.801 362.096ZM226.864 357.909L231.395 355.815L230.136 353.091L225.605 355.185L226.864 357.909ZM235.926 353.721L240.457 351.627L239.199 348.904L234.668 350.998L235.926 353.721ZM244.989 349.534L249.52 347.44L248.261 344.716L243.73 346.81L244.989 349.534ZM254.051 345.346L258.582 343.252L257.324 340.529L252.793 342.623L254.051 345.346ZM263.114 341.159L267.645 339.065L266.386 336.341L261.855 338.435L263.114 341.159ZM272.176 336.971L276.707 334.877L275.449 332.154L270.918 334.248L272.176 336.971ZM281.239 332.784L285.77 330.69L284.511 327.966L279.98 330.06L281.239 332.784ZM290.301 328.596L294.832 326.502L293.574 323.779L289.043 325.873L290.301 328.596ZM299.363 324.409L303.895 322.315L302.636 319.591L298.105 321.685L299.363 324.409ZM308.426 320.221L312.957 318.127L311.699 315.404L307.168 317.498L308.426 320.221ZM317.489 316.034L322.02 313.94L320.761 311.216L316.23 313.31L317.489 316.034ZM326.551 311.846L331.082 309.752L329.824 307.029L325.293 309.123L326.551 311.846ZM335.614 307.659L340.145 305.565L338.886 302.841L334.355 304.935L335.614 307.659ZM344.676 303.471L349.207 301.377L347.949 298.654L343.418 300.748L344.676 303.471ZM353.739 299.284L358.27 297.19L357.012 294.466L352.48 296.56L353.739 299.284ZM362.801 295.096L367.332 293.002L366.074 290.279L361.543 292.373L362.801 295.096Z" fill="black"/>
<path d="M83.5 192.5L92.1603 177.5H74.8397L83.5 192.5ZM83.5 58.5L74.8397 73.5H92.1603L83.5 58.5ZM85 179V72H82V179H85Z" fill="black"/>
<path d="M373.5 192.5L382.16 177.5H364.84L373.5 192.5ZM373.5 58.5L364.84 73.5H382.16L373.5 58.5ZM375 179V72H372V179H375Z" fill="black"/>
</svg>


</div>

Moving the logic of resilient task distribution into the cluster can provide a better solution. We can safely construct this logic within Aeron cluster because:

* Aeron cluster fires callbacks when a cluster client connects and disconnects
* We can direct outbound events from the cluster to any particular cluster client we elect

The logic inside the cluster would need to have the following components:

* On start, the cluster would need to know the list of connections to make. This can be loaded via the usual commands
* When a cluster client connects, we would need a command from the client registering itself with its capabilities. For example it may be `RegisterClient(API_GATEWAY)`.
* We can add a simple object which is then capable of knowing which Aeron Cluster clients are connected at any time, and of which type they are
* When outbound connectivity is needed, the logic can hold a hashmap of API Gateways to outbound connection, and define the rules around how to distribute the outbound connections. When a node is to open a connection, the cluster can direct a `ConnectionReadyToOpenEvent(party)` to the appropriate API Gateway.
* If a connected API Gateway is lost, the cluster logic can receive the event, and redistribute the tasks across the remaining connected services

## Options Compared

### Aeron Cluster

| Pros | Cons |
| :--- | :--- |
| Less moving parts | No management UI, this would have to be built |
| Full control over node balancing | More code to maintain |
| Fast recovery times (1-2s) |  |

### Consul/Zookeeper

| Pros | Cons |
| :--- | :--- |
| Known tool | Locks have TTL of no-less-than 10s |
| Easy to manage, full UI | Three+ additional processes to deploy |
| | Uneven task distribution |