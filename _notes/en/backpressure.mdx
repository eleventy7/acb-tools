---
category: 'note'
cover: './top.jpg'
title: 'Backpressure'
subtitle: 'Backpressure explained, and how it is deployed to build stable distributed systems'
description: 'Backpressure explained, and how it is deployed to build stable distributed systems'
date: '2020-12-12'
tags: ['Distributed Systems']
published: true
state: draft
updated: '2020-12-12'
importance: low
evergreen: ðŸŒ¿
series: 
seriesurl: 
review: continuous
---

Consider the following scenario: a `data source connector` is connected to an external source that produces a large volume of data. This connector converts the data format and sends to a `router`. 
The `router` in turn sends the data again to a `recipient` which is internally writing to a database cluster.

What happens when the database is unable to write messages fast enough?

<div align="center">
<svg width="80%" height="auto" viewBox="0 0 851 450" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M770.5 272.972L770.472 271.473L767.473 271.528L767.5 273.028L770.5 272.972ZM770.5 354.5L778.883 339.343L761.565 339.662L770.5 354.5ZM767.5 273.028L768.752 341.03L771.751 340.975L770.5 272.972L767.5 273.028Z" fill="black"/>
<path d="M84.7497 96.2224L84.7221 94.7227L81.7227 94.7779L81.7503 96.2776L84.7497 96.2224ZM84.75 177.75L93.1328 162.593L75.8152 162.912L84.75 177.75ZM81.7503 96.2776L83.0018 164.28L86.0013 164.225L84.7497 96.2224L81.7503 96.2776Z" fill="black"/>
<rect x="688" y="178" width="162" height="94" rx="3" fill="#ADF7BE" stroke="black" stroke-width="2"/>
<path d="M726.083 231H727.91V224.469H730.22L734.693 231H736.73L732.131 224.343C734.189 223.944 735.848 222.726 735.848 220.248V220.164C735.848 217.161 733.475 215.985 730.598 215.985H726.083V231ZM727.91 223.02V217.455H730.724C732.761 217.455 734.021 218.127 734.021 220.164V220.248C734.021 222.096 732.866 223.02 730.724 223.02H727.91ZM743.33 231.189C745.808 231.189 747.635 230.034 748.013 227.829H746.27C746.039 229.11 745.052 229.74 743.351 229.74C741.104 229.74 739.907 228.354 739.823 225.855H748.097V225.288C748.097 221.361 745.703 219.828 743.162 219.828C740.138 219.828 738.017 222.138 738.017 225.456V225.624C738.017 229.005 740.222 231.189 743.33 231.189ZM739.886 224.448C740.18 222.495 741.377 221.277 743.162 221.277C744.968 221.277 746.144 222.18 746.312 224.448H739.886ZM755.329 231.189C757.975 231.189 759.886 229.425 760.117 227.052H758.5C758.311 228.837 756.904 229.74 755.35 229.74C753.229 229.74 751.759 228.312 751.759 225.624V225.456C751.759 222.873 753.292 221.277 755.287 221.277C756.799 221.277 758.059 221.928 758.332 223.671H760.054C759.718 220.878 757.576 219.828 755.287 219.828C752.347 219.828 749.953 222.096 749.953 225.456V225.624C749.953 229.026 752.263 231.189 755.329 231.189ZM762.79 231H764.533V220.017H762.79V231ZM763.63 217.728C764.26 217.728 764.785 217.203 764.785 216.573C764.785 215.943 764.26 215.418 763.63 215.418C763 215.418 762.475 215.943 762.475 216.573C762.475 217.203 763 217.728 763.63 217.728ZM768.101 234.822H769.844V229.194C770.474 230.286 771.755 231.189 773.561 231.189C776.585 231.189 778.559 228.879 778.559 225.519V225.351C778.559 221.928 776.438 219.828 773.561 219.828C771.965 219.828 770.474 220.794 769.844 221.865V220.017H768.101V234.822ZM773.393 229.74C771.251 229.74 769.781 228.417 769.781 225.603V225.435C769.781 222.621 771.335 221.277 773.372 221.277C775.22 221.277 776.753 222.663 776.753 225.435V225.603C776.753 228.27 775.577 229.74 773.393 229.74ZM781.309 231H783.052V220.017H781.309V231ZM782.149 217.728C782.779 217.728 783.304 217.203 783.304 216.573C783.304 215.943 782.779 215.418 782.149 215.418C781.519 215.418 780.994 215.943 780.994 216.573C780.994 217.203 781.519 217.728 782.149 217.728ZM791.113 231.189C793.591 231.189 795.418 230.034 795.796 227.829H794.053C793.822 229.11 792.835 229.74 791.134 229.74C788.887 229.74 787.69 228.354 787.606 225.855H795.88V225.288C795.88 221.361 793.486 219.828 790.945 219.828C787.921 219.828 785.8 222.138 785.8 225.456V225.624C785.8 229.005 788.005 231.189 791.113 231.189ZM787.669 224.448C787.963 222.495 789.16 221.277 790.945 221.277C792.751 221.277 793.927 222.18 794.095 224.448H787.669ZM798.555 231H800.298V224.343C800.298 222.369 801.747 221.34 803.364 221.34C805.128 221.34 805.947 222.201 805.947 224.133V231H807.69V224.259C807.69 221.067 806.094 219.828 803.826 219.828C802.02 219.828 800.802 220.731 800.298 221.76V220.017H798.555V231ZM814.445 231.147C815.159 231.147 815.579 231.042 815.936 230.916V229.446C815.558 229.593 815.138 229.677 814.592 229.677C813.71 229.677 813.227 229.152 813.227 228.081V221.487H815.789V220.017H813.227V217.518H811.484V220.017H809.909V221.487H811.484V228.249C811.484 229.971 812.45 231.147 814.445 231.147Z" fill="black"/>
<rect x="345" y="178" width="162" height="94" rx="3" fill="#FFFDE1" stroke="black" stroke-width="2"/>
<path d="M395.231 231H397.058V224.469H399.368L403.841 231H405.878L401.279 224.343C403.337 223.944 404.996 222.726 404.996 220.248V220.164C404.996 217.161 402.623 215.985 399.746 215.985H395.231V231ZM397.058 223.02V217.455H399.872C401.909 217.455 403.169 218.127 403.169 220.164V220.248C403.169 222.096 402.014 223.02 399.872 223.02H397.058ZM412.562 229.74C410.336 229.74 408.971 228.102 408.971 225.603V225.435C408.971 222.915 410.357 221.277 412.562 221.277C414.746 221.277 416.153 222.915 416.153 225.456V225.603C416.153 228.081 414.767 229.74 412.562 229.74ZM412.541 231.189C415.67 231.189 417.959 228.9 417.959 225.582V225.414C417.959 222.117 415.67 219.828 412.562 219.828C409.454 219.828 407.165 222.138 407.165 225.435V225.603C407.165 228.816 409.412 231.189 412.541 231.189ZM424.375 231.189C426.139 231.189 427.357 230.286 427.861 229.257V231H429.604V220.017H427.861V226.674C427.861 228.648 426.391 229.677 424.837 229.677C423.115 229.677 422.296 228.816 422.296 226.884V220.017H420.553V226.968C420.553 229.992 422.191 231.189 424.375 231.189ZM436.466 231.147C437.18 231.147 437.6 231.042 437.957 230.916V229.446C437.579 229.593 437.159 229.677 436.613 229.677C435.731 229.677 435.248 229.152 435.248 228.081V221.487H437.81V220.017H435.248V217.518H433.505V220.017H431.93V221.487H433.505V228.249C433.505 229.971 434.471 231.147 436.466 231.147ZM445.086 231.189C447.564 231.189 449.391 230.034 449.769 227.829H448.026C447.795 229.11 446.808 229.74 445.107 229.74C442.86 229.74 441.663 228.354 441.579 225.855H449.853V225.288C449.853 221.361 447.459 219.828 444.918 219.828C441.894 219.828 439.773 222.138 439.773 225.456V225.624C439.773 229.005 441.978 231.189 445.086 231.189ZM441.642 224.448C441.936 222.495 443.133 221.277 444.918 221.277C446.724 221.277 447.9 222.18 448.068 224.448H441.642ZM452.527 231H454.27V224.973C454.27 222.264 455.677 221.571 457.882 221.466V219.828C455.908 219.891 454.963 220.752 454.27 221.991V220.017H452.527V231Z" fill="black"/>
<rect x="1" y="178" width="162" height="94" rx="3" fill="#E2E4F4" stroke="black" stroke-width="2"/>
<rect x="1" y="1" width="162" height="94" rx="3" fill="#E2E4F4" stroke="black" stroke-width="2"/>
<path d="M508.5 224H507V227H508.5V224ZM688.5 225.5L673.5 216.84V234.16L688.5 225.5ZM511 227H512.5V224H511V227ZM518 224H516.5V227H518V224ZM523 227H524.5V224H523V227ZM530 224H528.5V227H530V224ZM535 227H536.5V224H535V227ZM542 224H540.5V227H542V224ZM547 227H548.5V224H547V227ZM554 224H552.5V227H554V224ZM559 227H560.5V224H559V227ZM566 224H564.5V227H566V224ZM571 227H572.5V224H571V227ZM578 224H576.5V227H578V224ZM583 227H584.5V224H583V227ZM590 224H588.5V227H590V224ZM595 227H596.5V224H595V227ZM602 224H600.5V227H602V224ZM607 227H608.5V224H607V227ZM614 224H612.5V227H614V224ZM619 227H620.5V224H619V227ZM626 224H624.5V227H626V224ZM631 227H632.5V224H631V227ZM638 224H636.5V227H638V224ZM643 227H644.5V224H643V227ZM650 224H648.5V227H650V224ZM655 227H656.5V224H655V227ZM662 224H660.5V227H662V224ZM667 227H668.5V224H667V227ZM674 224H672.5V227H674V224ZM679 227H680.5V224H679V227ZM686 224H684.5V227H686V224ZM508.5 227H511V224H508.5V227ZM518 227H523V224H518V227ZM530 227H535V224H530V227ZM542 227H547V224H542V227ZM554 227H559V224H554V227ZM566 227H571V224H566V227ZM578 227H583V224H578V227ZM590 227H595V224H590V227ZM602 227H607V224H602V227ZM614 227H619V224H614V227ZM626 227H631V224H626V227ZM638 227H643V224H638V227ZM650 227H655V224H650V227ZM662 227H667V224H662V227ZM674 227H679V224H674V227Z" fill="black"/>
<path d="M164 223.5H162.5V226.5H164V223.5ZM344 225L329 216.34V233.66L344 225ZM166.5 226.5H168V223.5H166.5V226.5ZM173.5 223.5H172V226.5H173.5V223.5ZM178.5 226.5H180V223.5H178.5V226.5ZM185.5 223.5H184V226.5H185.5V223.5ZM190.5 226.5H192V223.5H190.5V226.5ZM197.5 223.5H196V226.5H197.5V223.5ZM202.5 226.5H204V223.5H202.5V226.5ZM209.5 223.5H208V226.5H209.5V223.5ZM214.5 226.5H216V223.5H214.5V226.5ZM221.5 223.5H220V226.5H221.5V223.5ZM226.5 226.5H228V223.5H226.5V226.5ZM233.5 223.5H232V226.5H233.5V223.5ZM238.5 226.5H240V223.5H238.5V226.5ZM245.5 223.5H244V226.5H245.5V223.5ZM250.5 226.5H252V223.5H250.5V226.5ZM257.5 223.5H256V226.5H257.5V223.5ZM262.5 226.5H264V223.5H262.5V226.5ZM269.5 223.5H268V226.5H269.5V223.5ZM274.5 226.5H276V223.5H274.5V226.5ZM281.5 223.5H280V226.5H281.5V223.5ZM286.5 226.5H288V223.5H286.5V226.5ZM293.5 223.5H292V226.5H293.5V223.5ZM298.5 226.5H300V223.5H298.5V226.5ZM305.5 223.5H304V226.5H305.5V223.5ZM310.5 226.5H312V223.5H310.5V226.5ZM317.5 223.5H316V226.5H317.5V223.5ZM322.5 226.5H324V223.5H322.5V226.5ZM329.5 223.5H328V226.5H329.5V223.5ZM334.5 226.5H336V223.5H334.5V226.5ZM341.5 223.5H340V226.5H341.5V223.5ZM164 226.5H166.5V223.5H164V226.5ZM173.5 226.5H178.5V223.5H173.5V226.5ZM185.5 226.5H190.5V223.5H185.5V226.5ZM197.5 226.5H202.5V223.5H197.5V226.5ZM209.5 226.5H214.5V223.5H209.5V226.5ZM221.5 226.5H226.5V223.5H221.5V226.5ZM233.5 226.5H238.5V223.5H233.5V226.5ZM245.5 226.5H250.5V223.5H245.5V226.5ZM257.5 226.5H262.5V223.5H257.5V226.5ZM269.5 226.5H274.5V223.5H269.5V226.5ZM281.5 226.5H286.5V223.5H281.5V226.5ZM293.5 226.5H298.5V223.5H293.5V226.5ZM305.5 226.5H310.5V223.5H305.5V226.5ZM317.5 226.5H322.5V223.5H317.5V226.5ZM329.5 226.5H334.5V223.5H329.5V226.5Z" fill="black"/>
<path d="M25.0983 215.509V203.455H27.1353C31.2723 203.455 32.9523 205.891 32.9523 209.356V209.524C32.9523 213.199 31.0203 215.509 27.1563 215.509H25.0983ZM23.2713 217H27.1983C32.4483 217 34.8423 213.703 34.8423 209.545V209.356C34.8423 205.177 32.4063 201.985 27.2403 201.985H23.2713V217ZM40.5184 217.189C42.1354 217.189 43.1224 216.643 43.9414 215.614V217H45.6844V209.755C45.6844 206.689 43.7734 205.828 41.6734 205.828C39.5524 205.828 37.5574 206.752 37.3264 209.251H39.0694C39.2374 207.907 40.0774 207.277 41.5894 207.277C43.2694 207.277 43.9414 208.012 43.9414 209.755V210.553H42.3664C39.5524 210.553 36.8644 211.414 36.8644 213.955C36.8644 216.202 38.4814 217.189 40.5184 217.189ZM40.6864 215.803C39.1534 215.803 38.6074 215.089 38.6074 213.955C38.6074 212.338 40.2244 211.792 42.4294 211.792H43.9414V213.157C43.9414 214.858 42.5344 215.803 40.6864 215.803ZM52.4472 217.147C53.1612 217.147 53.5812 217.042 53.9382 216.916V215.446C53.5602 215.593 53.1402 215.677 52.5942 215.677C51.7122 215.677 51.2292 215.152 51.2292 214.081V207.487H53.7912V206.017H51.2292V203.518H49.4862V206.017H47.9112V207.487H49.4862V214.249C49.4862 215.971 50.4522 217.147 52.4472 217.147ZM59.4266 217.189C61.0436 217.189 62.0306 216.643 62.8496 215.614V217H64.5926V209.755C64.5926 206.689 62.6816 205.828 60.5816 205.828C58.4606 205.828 56.4656 206.752 56.2346 209.251H57.9776C58.1456 207.907 58.9856 207.277 60.4976 207.277C62.1776 207.277 62.8496 208.012 62.8496 209.755V210.553H61.2746C58.4606 210.553 55.7726 211.414 55.7726 213.955C55.7726 216.202 57.3896 217.189 59.4266 217.189ZM59.5946 215.803C58.0616 215.803 57.5156 215.089 57.5156 213.955C57.5156 212.338 59.1326 211.792 61.3376 211.792H62.8496V213.157C62.8496 214.858 61.4426 215.803 59.5946 215.803ZM78.5511 217.189C81.5331 217.189 83.7381 215.278 83.7381 212.758C83.7381 209.923 81.9741 208.915 78.6351 208.39C75.5691 207.928 75.0231 207.172 75.0231 205.702C75.0231 204.295 76.0941 203.266 78.1521 203.266C80.2311 203.266 81.3231 204.043 81.6801 205.933H83.3181C83.0241 203.266 81.1551 201.796 78.1521 201.796C75.3171 201.796 73.3221 203.56 73.3221 205.87C73.3221 208.537 75.1911 209.524 78.3411 210.007C81.1971 210.469 81.9741 211.183 81.9741 212.884C81.9741 214.585 80.4831 215.719 78.5511 215.719C75.5271 215.719 74.8131 214.207 74.5821 212.422H72.8181C73.0911 214.984 74.5401 217.189 78.5511 217.189ZM91.3181 215.74C89.0921 215.74 87.7271 214.102 87.7271 211.603V211.435C87.7271 208.915 89.1131 207.277 91.3181 207.277C93.5021 207.277 94.9091 208.915 94.9091 211.456V211.603C94.9091 214.081 93.5231 215.74 91.3181 215.74ZM91.2971 217.189C94.4261 217.189 96.7151 214.9 96.7151 211.582V211.414C96.7151 208.117 94.4261 205.828 91.3181 205.828C88.2101 205.828 85.9211 208.138 85.9211 211.435V211.603C85.9211 214.816 88.1681 217.189 91.2971 217.189ZM103.131 217.189C104.895 217.189 106.113 216.286 106.617 215.257V217H108.36V206.017H106.617V212.674C106.617 214.648 105.147 215.677 103.593 215.677C101.871 215.677 101.052 214.816 101.052 212.884V206.017H99.3089V212.968C99.3089 215.992 100.947 217.189 103.131 217.189ZM111.883 217H113.626V210.973C113.626 208.264 115.033 207.571 117.238 207.466V205.828C115.264 205.891 114.319 206.752 113.626 207.991V206.017H111.883V217ZM124.028 217.189C126.674 217.189 128.585 215.425 128.816 213.052H127.199C127.01 214.837 125.603 215.74 124.049 215.74C121.928 215.74 120.458 214.312 120.458 211.624V211.456C120.458 208.873 121.991 207.277 123.986 207.277C125.498 207.277 126.758 207.928 127.031 209.671H128.753C128.417 206.878 126.275 205.828 123.986 205.828C121.046 205.828 118.652 208.096 118.652 211.456V211.624C118.652 215.026 120.962 217.189 124.028 217.189ZM135.941 217.189C138.419 217.189 140.246 216.034 140.624 213.829H138.881C138.65 215.11 137.663 215.74 135.962 215.74C133.715 215.74 132.518 214.354 132.434 211.855H140.708V211.288C140.708 207.361 138.314 205.828 135.773 205.828C132.749 205.828 130.628 208.138 130.628 211.456V211.624C130.628 215.005 132.833 217.189 135.941 217.189ZM132.497 210.448C132.791 208.495 133.988 207.277 135.773 207.277C137.579 207.277 138.755 208.18 138.923 210.448H132.497ZM37.1382 245.189C40.4982 245.189 42.8922 243.488 43.4172 240.023H41.7162C41.3382 242.459 39.6372 243.698 37.1802 243.698C33.9462 243.698 32.0142 241.388 32.0142 237.566V237.398C32.0142 233.618 34.0932 231.203 37.2012 231.203C39.7632 231.203 41.0862 232.379 41.4642 234.668H43.2702C42.9552 231.413 40.3092 229.754 37.1802 229.754C33.1062 229.754 30.1242 232.967 30.1242 237.419V237.587C30.1242 242.207 32.7912 245.189 37.1382 245.189ZM50.6511 243.74C48.4251 243.74 47.0601 242.102 47.0601 239.603V239.435C47.0601 236.915 48.4461 235.277 50.6511 235.277C52.8351 235.277 54.2421 236.915 54.2421 239.456V239.603C54.2421 242.081 52.8561 243.74 50.6511 243.74ZM50.6301 245.189C53.7591 245.189 56.0481 242.9 56.0481 239.582V239.414C56.0481 236.117 53.7591 233.828 50.6511 233.828C47.5431 233.828 45.2541 236.138 45.2541 239.435V239.603C45.2541 242.816 47.5011 245.189 50.6301 245.189ZM58.7469 245H60.4899V238.343C60.4899 236.369 61.9389 235.34 63.5559 235.34C65.3199 235.34 66.1389 236.201 66.1389 238.133V245H67.8819V238.259C67.8819 235.067 66.2859 233.828 64.0179 233.828C62.2119 233.828 60.9939 234.731 60.4899 235.76V234.017H58.7469V245ZM71.2977 245H73.0407V238.343C73.0407 236.369 74.4897 235.34 76.1067 235.34C77.8707 235.34 78.6897 236.201 78.6897 238.133V245H80.4327V238.259C80.4327 235.067 78.8367 233.828 76.5687 233.828C74.7627 233.828 73.5447 234.731 73.0407 235.76V234.017H71.2977V245ZM88.3425 245.189C90.8205 245.189 92.6475 244.034 93.0255 241.829H91.2825C91.0515 243.11 90.0645 243.74 88.3635 243.74C86.1165 243.74 84.9195 242.354 84.8355 239.855H93.1095V239.288C93.1095 235.361 90.7155 233.828 88.1745 233.828C85.1505 233.828 83.0295 236.138 83.0295 239.456V239.624C83.0295 243.005 85.2345 245.189 88.3425 245.189ZM84.8985 238.448C85.1925 236.495 86.3895 235.277 88.1745 235.277C89.9805 235.277 91.1565 236.18 91.3245 238.448H84.8985ZM100.341 245.189C102.987 245.189 104.898 243.425 105.129 241.052H103.512C103.323 242.837 101.916 243.74 100.362 243.74C98.241 243.74 96.771 242.312 96.771 239.624V239.456C96.771 236.873 98.304 235.277 100.299 235.277C101.811 235.277 103.071 235.928 103.344 237.671H105.066C104.73 234.878 102.588 233.828 100.299 233.828C97.359 233.828 94.965 236.096 94.965 239.456V239.624C94.965 243.026 97.275 245.189 100.341 245.189ZM111.1 245.147C111.814 245.147 112.234 245.042 112.591 244.916V243.446C112.213 243.593 111.793 243.677 111.247 243.677C110.365 243.677 109.882 243.152 109.882 242.081V235.487H112.444V234.017H109.882V231.518H108.139V234.017H106.564V235.487H108.139V242.249C108.139 243.971 109.105 245.147 111.1 245.147ZM119.803 243.74C117.577 243.74 116.212 242.102 116.212 239.603V239.435C116.212 236.915 117.598 235.277 119.803 235.277C121.987 235.277 123.394 236.915 123.394 239.456V239.603C123.394 242.081 122.008 243.74 119.803 243.74ZM119.782 245.189C122.911 245.189 125.2 242.9 125.2 239.582V239.414C125.2 236.117 122.911 233.828 119.803 233.828C116.695 233.828 114.406 236.138 114.406 239.435V239.603C114.406 242.816 116.653 245.189 119.782 245.189ZM127.899 245H129.642V238.973C129.642 236.264 131.049 235.571 133.254 235.466V233.828C131.28 233.891 130.335 234.752 129.642 235.991V234.017H127.899V245Z" fill="black"/>
<path d="M43.5638 43H52.6988V41.509H45.3908V36.07H50.9768V34.579H45.3908V29.476H52.3208V27.985H43.5638V43ZM54.2589 43H56.1279L59.1519 38.569L62.1129 43H64.1709L60.1599 37.225L63.7929 32.017H61.9029L59.2359 36.007L56.5479 32.017H54.5109L58.1859 37.351L54.2589 43ZM69.8686 43.147C70.5826 43.147 71.0026 43.042 71.3596 42.916V41.446C70.9816 41.593 70.5616 41.677 70.0156 41.677C69.1336 41.677 68.6506 41.152 68.6506 40.081V33.487H71.2126V32.017H68.6506V29.518H66.9076V32.017H65.3326V33.487H66.9076V40.249C66.9076 41.971 67.8736 43.147 69.8686 43.147ZM78.4885 43.189C80.9665 43.189 82.7935 42.034 83.1715 39.829H81.4285C81.1975 41.11 80.2105 41.74 78.5095 41.74C76.2625 41.74 75.0655 40.354 74.9815 37.855H83.2555V37.288C83.2555 33.361 80.8615 31.828 78.3205 31.828C75.2965 31.828 73.1755 34.138 73.1755 37.456V37.624C73.1755 41.005 75.3805 43.189 78.4885 43.189ZM75.0445 36.448C75.3385 34.495 76.5355 33.277 78.3205 33.277C80.1265 33.277 81.3025 34.18 81.4705 36.448H75.0445ZM85.93 43H87.673V36.973C87.673 34.264 89.08 33.571 91.285 33.466V31.828C89.311 31.891 88.366 32.752 87.673 33.991V32.017H85.93V43ZM93.8255 43H95.5685V36.343C95.5685 34.369 97.0175 33.34 98.6345 33.34C100.399 33.34 101.218 34.201 101.218 36.133V43H102.961V36.259C102.961 33.067 101.365 31.828 99.0965 31.828C97.2905 31.828 96.0725 32.731 95.5685 33.76V32.017H93.8255V43ZM109.127 43.189C110.744 43.189 111.731 42.643 112.55 41.614V43H114.293V35.755C114.293 32.689 112.382 31.828 110.282 31.828C108.161 31.828 106.166 32.752 105.935 35.251H107.678C107.846 33.907 108.686 33.277 110.198 33.277C111.878 33.277 112.55 34.012 112.55 35.755V36.553H110.975C108.161 36.553 105.473 37.414 105.473 39.955C105.473 42.202 107.09 43.189 109.127 43.189ZM109.295 41.803C107.762 41.803 107.216 41.089 107.216 39.955C107.216 38.338 108.833 37.792 111.038 37.792H112.55V39.157C112.55 40.858 111.143 41.803 109.295 41.803ZM117.759 43H119.523V26.767H117.759V43ZM25.0983 69.509V57.455H27.1353C31.2723 57.455 32.9523 59.891 32.9523 63.356V63.524C32.9523 67.199 31.0203 69.509 27.1563 69.509H25.0983ZM23.2713 71H27.1983C32.4483 71 34.8423 67.703 34.8423 63.545V63.356C34.8423 59.177 32.4063 55.985 27.2403 55.985H23.2713V71ZM40.5184 71.189C42.1354 71.189 43.1224 70.643 43.9414 69.614V71H45.6844V63.755C45.6844 60.689 43.7734 59.828 41.6734 59.828C39.5524 59.828 37.5574 60.752 37.3264 63.251H39.0694C39.2374 61.907 40.0774 61.277 41.5894 61.277C43.2694 61.277 43.9414 62.012 43.9414 63.755V64.553H42.3664C39.5524 64.553 36.8644 65.414 36.8644 67.955C36.8644 70.202 38.4814 71.189 40.5184 71.189ZM40.6864 69.803C39.1534 69.803 38.6074 69.089 38.6074 67.955C38.6074 66.338 40.2244 65.792 42.4294 65.792H43.9414V67.157C43.9414 68.858 42.5344 69.803 40.6864 69.803ZM52.4472 71.147C53.1612 71.147 53.5812 71.042 53.9382 70.916V69.446C53.5602 69.593 53.1402 69.677 52.5942 69.677C51.7122 69.677 51.2292 69.152 51.2292 68.081V61.487H53.7912V60.017H51.2292V57.518H49.4862V60.017H47.9112V61.487H49.4862V68.249C49.4862 69.971 50.4522 71.147 52.4472 71.147ZM59.4266 71.189C61.0436 71.189 62.0306 70.643 62.8496 69.614V71H64.5926V63.755C64.5926 60.689 62.6816 59.828 60.5816 59.828C58.4606 59.828 56.4656 60.752 56.2346 63.251H57.9776C58.1456 61.907 58.9856 61.277 60.4976 61.277C62.1776 61.277 62.8496 62.012 62.8496 63.755V64.553H61.2746C58.4606 64.553 55.7726 65.414 55.7726 67.955C55.7726 70.202 57.3896 71.189 59.4266 71.189ZM59.5946 69.803C58.0616 69.803 57.5156 69.089 57.5156 67.955C57.5156 66.338 59.1326 65.792 61.3376 65.792H62.8496V67.157C62.8496 68.858 61.4426 69.803 59.5946 69.803ZM78.5511 71.189C81.5331 71.189 83.7381 69.278 83.7381 66.758C83.7381 63.923 81.9741 62.915 78.6351 62.39C75.5691 61.928 75.0231 61.172 75.0231 59.702C75.0231 58.295 76.0941 57.266 78.1521 57.266C80.2311 57.266 81.3231 58.043 81.6801 59.933H83.3181C83.0241 57.266 81.1551 55.796 78.1521 55.796C75.3171 55.796 73.3221 57.56 73.3221 59.87C73.3221 62.537 75.1911 63.524 78.3411 64.007C81.1971 64.469 81.9741 65.183 81.9741 66.884C81.9741 68.585 80.4831 69.719 78.5511 69.719C75.5271 69.719 74.8131 68.207 74.5821 66.422H72.8181C73.0911 68.984 74.5401 71.189 78.5511 71.189ZM91.3181 69.74C89.0921 69.74 87.7271 68.102 87.7271 65.603V65.435C87.7271 62.915 89.1131 61.277 91.3181 61.277C93.5021 61.277 94.9091 62.915 94.9091 65.456V65.603C94.9091 68.081 93.5231 69.74 91.3181 69.74ZM91.2971 71.189C94.4261 71.189 96.7151 68.9 96.7151 65.582V65.414C96.7151 62.117 94.4261 59.828 91.3181 59.828C88.2101 59.828 85.9211 62.138 85.9211 65.435V65.603C85.9211 68.816 88.1681 71.189 91.2971 71.189ZM103.131 71.189C104.895 71.189 106.113 70.286 106.617 69.257V71H108.36V60.017H106.617V66.674C106.617 68.648 105.147 69.677 103.593 69.677C101.871 69.677 101.052 68.816 101.052 66.884V60.017H99.3089V66.968C99.3089 69.992 100.947 71.189 103.131 71.189ZM111.883 71H113.626V64.973C113.626 62.264 115.033 61.571 117.238 61.466V59.828C115.264 59.891 114.319 60.752 113.626 61.991V60.017H111.883V71ZM124.028 71.189C126.674 71.189 128.585 69.425 128.816 67.052H127.199C127.01 68.837 125.603 69.74 124.049 69.74C121.928 69.74 120.458 68.312 120.458 65.624V65.456C120.458 62.873 121.991 61.277 123.986 61.277C125.498 61.277 126.758 61.928 127.031 63.671H128.753C128.417 60.878 126.275 59.828 123.986 59.828C121.046 59.828 118.652 62.096 118.652 65.456V65.624C118.652 69.026 120.962 71.189 124.028 71.189ZM135.941 71.189C138.419 71.189 140.246 70.034 140.624 67.829H138.881C138.65 69.11 137.663 69.74 135.962 69.74C133.715 69.74 132.518 68.354 132.434 65.855H140.708V65.288C140.708 61.361 138.314 59.828 135.773 59.828C132.749 59.828 130.628 62.138 130.628 65.456V65.624C130.628 69.005 132.833 71.189 135.941 71.189ZM132.497 64.448C132.791 62.495 133.988 61.277 135.773 61.277C137.579 61.277 138.755 62.18 138.923 64.448H132.497Z" fill="black"/>
<rect x="688" y="355" width="162" height="94" rx="3" fill="#ADF7BE" stroke="black" stroke-width="2"/>
<path d="M727.015 395.509V383.455H729.052C733.189 383.455 734.869 385.891 734.869 389.356V389.524C734.869 393.199 732.937 395.509 729.073 395.509H727.015ZM725.188 397H729.115C734.365 397 736.759 393.703 736.759 389.545V389.356C736.759 385.177 734.323 381.985 729.157 381.985H725.188V397ZM742.435 397.189C744.052 397.189 745.039 396.643 745.858 395.614V397H747.601V389.755C747.601 386.689 745.69 385.828 743.59 385.828C741.469 385.828 739.474 386.752 739.243 389.251H740.986C741.154 387.907 741.994 387.277 743.506 387.277C745.186 387.277 745.858 388.012 745.858 389.755V390.553H744.283C741.469 390.553 738.781 391.414 738.781 393.955C738.781 396.202 740.398 397.189 742.435 397.189ZM742.603 395.803C741.07 395.803 740.524 395.089 740.524 393.955C740.524 392.338 742.141 391.792 744.346 391.792H745.858V393.157C745.858 394.858 744.451 395.803 742.603 395.803ZM754.364 397.147C755.078 397.147 755.498 397.042 755.855 396.916V395.446C755.477 395.593 755.057 395.677 754.511 395.677C753.629 395.677 753.146 395.152 753.146 394.081V387.487H755.708V386.017H753.146V383.518H751.403V386.017H749.828V387.487H751.403V394.249C751.403 395.971 752.369 397.147 754.364 397.147ZM761.344 397.189C762.961 397.189 763.948 396.643 764.767 395.614V397H766.51V389.755C766.51 386.689 764.599 385.828 762.499 385.828C760.378 385.828 758.383 386.752 758.152 389.251H759.895C760.063 387.907 760.903 387.277 762.415 387.277C764.095 387.277 764.767 388.012 764.767 389.755V390.553H763.192C760.378 390.553 757.69 391.414 757.69 393.955C757.69 396.202 759.307 397.189 761.344 397.189ZM761.512 395.803C759.979 395.803 759.433 395.089 759.433 393.955C759.433 392.338 761.05 391.792 763.255 391.792H764.767V393.157C764.767 394.858 763.36 395.803 761.512 395.803ZM775.393 397.189C778.417 397.189 780.391 394.879 780.391 391.519V391.351C780.391 387.928 778.27 385.828 775.393 385.828C773.797 385.828 772.306 386.794 771.676 387.865V380.767H769.933V397H771.676V395.194C772.306 396.286 773.608 397.189 775.393 397.189ZM775.225 395.74C773.083 395.74 771.613 394.417 771.613 391.603V391.435C771.613 388.621 773.167 387.277 775.204 387.277C777.052 387.277 778.585 388.663 778.585 391.435V391.603C778.585 394.27 777.409 395.74 775.225 395.74ZM785.85 397.189C787.467 397.189 788.454 396.643 789.273 395.614V397H791.016V389.755C791.016 386.689 789.105 385.828 787.005 385.828C784.884 385.828 782.889 386.752 782.658 389.251H784.401C784.569 387.907 785.409 387.277 786.921 387.277C788.601 387.277 789.273 388.012 789.273 389.755V390.553H787.698C784.884 390.553 782.196 391.414 782.196 393.955C782.196 396.202 783.813 397.189 785.85 397.189ZM786.018 395.803C784.485 395.803 783.939 395.089 783.939 393.955C783.939 392.338 785.556 391.792 787.761 391.792H789.273V393.157C789.273 394.858 787.866 395.803 786.018 395.803ZM797.842 397.189C800.509 397.189 801.874 395.845 801.874 393.85C801.874 391.519 800.278 391.015 798.01 390.595C795.994 390.238 795.448 389.839 795.448 388.852C795.448 387.907 796.267 387.277 797.527 387.277C798.913 387.277 799.585 387.802 799.837 388.999H801.517C801.223 386.626 799.522 385.828 797.548 385.828C795.826 385.828 793.831 386.878 793.831 388.915C793.831 390.826 794.797 391.624 797.653 392.149C799.354 392.464 800.215 392.842 800.215 393.997C800.215 395.173 799.48 395.74 797.821 395.74C796.057 395.74 795.364 394.921 795.238 393.619H793.537C793.642 395.866 795.217 397.189 797.842 397.189ZM809.024 397.189C811.502 397.189 813.329 396.034 813.707 393.829H811.964C811.733 395.11 810.746 395.74 809.045 395.74C806.798 395.74 805.601 394.354 805.517 391.855H813.791V391.288C813.791 387.361 811.397 385.828 808.856 385.828C805.832 385.828 803.711 388.138 803.711 391.456V391.624C803.711 395.005 805.916 397.189 809.024 397.189ZM805.58 390.448C805.874 388.495 807.071 387.277 808.856 387.277C810.662 387.277 811.838 388.18 812.006 390.448H805.58ZM741.885 425.189C745.245 425.189 747.639 423.488 748.164 420.023H746.463C746.085 422.459 744.384 423.698 741.927 423.698C738.693 423.698 736.761 421.388 736.761 417.566V417.398C736.761 413.618 738.84 411.203 741.948 411.203C744.51 411.203 745.833 412.379 746.211 414.668H748.017C747.702 411.413 745.056 409.754 741.927 409.754C737.853 409.754 734.871 412.967 734.871 417.419V417.587C734.871 422.207 737.538 425.189 741.885 425.189ZM750.862 425H752.626V408.767H750.862V425ZM759.91 425.189C761.674 425.189 762.892 424.286 763.396 423.257V425H765.139V414.017H763.396V420.674C763.396 422.648 761.926 423.677 760.372 423.677C758.65 423.677 757.831 422.816 757.831 420.884V414.017H756.088V420.968C756.088 423.992 757.726 425.189 759.91 425.189ZM772.064 425.189C774.731 425.189 776.096 423.845 776.096 421.85C776.096 419.519 774.5 419.015 772.232 418.595C770.216 418.238 769.67 417.839 769.67 416.852C769.67 415.907 770.489 415.277 771.749 415.277C773.135 415.277 773.807 415.802 774.059 416.999H775.739C775.445 414.626 773.744 413.828 771.77 413.828C770.048 413.828 768.053 414.878 768.053 416.915C768.053 418.826 769.019 419.624 771.875 420.149C773.576 420.464 774.437 420.842 774.437 421.997C774.437 423.173 773.702 423.74 772.043 423.74C770.279 423.74 769.586 422.921 769.46 421.619H767.759C767.864 423.866 769.439 425.189 772.064 425.189ZM782.091 425.147C782.805 425.147 783.225 425.042 783.582 424.916V423.446C783.204 423.593 782.784 423.677 782.238 423.677C781.356 423.677 780.873 423.152 780.873 422.081V415.487H783.435V414.017H780.873V411.518H779.13V414.017H777.555V415.487H779.13V422.249C779.13 423.971 780.096 425.147 782.091 425.147ZM790.711 425.189C793.189 425.189 795.016 424.034 795.394 421.829H793.651C793.42 423.11 792.433 423.74 790.732 423.74C788.485 423.74 787.288 422.354 787.204 419.855H795.478V419.288C795.478 415.361 793.084 413.828 790.543 413.828C787.519 413.828 785.398 416.138 785.398 419.456V419.624C785.398 423.005 787.603 425.189 790.711 425.189ZM787.267 418.448C787.561 416.495 788.758 415.277 790.543 415.277C792.349 415.277 793.525 416.18 793.693 418.448H787.267ZM798.152 425H799.895V418.973C799.895 416.264 801.302 415.571 803.507 415.466V413.828C801.533 413.891 800.588 414.752 799.895 415.991V414.017H798.152V425Z" fill="black"/>
</svg>

</div>

Somewhere, something will break. At some point, the `router` will either face a significant slow down or no longer be able to send messages on to the `recipient` process. Once the `router` starts slowing down or failing to send, what will happen to the `data source connector`? As the failure starts spreading from right to left, the wider system is likely to become unstable.

This problem often happens when producers are sending data faster than either the network, intermediate process (for example a message bus) or destination process can accept. To solve this, we need to apply backpressure so that the upstream process can understand that there is a problem.

## Common definitions

- Wikipedia defines backpressure as "resistance or force opposing the desired flow of fluid through pipes"
- The Reactive Manifesto defines it as "When one component is struggling to keep-up, the system as a whole needs to respond in a sensible way. It is unacceptable for the component under stress to fail catastrophically or to drop messages in an uncontrolled fashion. Since it canâ€™t cope and it canâ€™t fail it should communicate the fact that it is under stress to upstream components and so get them to reduce the load"

## Exerting backpressure

There are different techniques to signal backpressure to a publishing application:

- with most messaging systems, producer backpressure is built in and dealt with via the APIs. See [Producer Backpressure in Messaging Systems](../../article/producer-backpressure-survey/)
- with other systems - for example a HTTP, FIX or WebSocket server - the easiest way to apply backpressure to producers is often simply shedding the load. This could be done selectively for specific clients, or the entire process at a whole.

## Handling backpressure

There are several tactics that can applied by producers:

- Drop the all or certain classes of messages in the publisher. This is how [LOGback's AsyncAppender](https://logback.qos.ch/manual/appenders.html#AsyncAppender) operates - if the buffer space is exceeded, TRACE, DEBUG and INFO messages start getting dropped once the buffer is at 80% capacity.  
- Increase publisher buffer sizes. This would help in scenarios where there was only a temporary increase in data send rates.
- Slow down the publisher - this is simple if you control the inputs, but can sometimes be very hard to do - for example, if you have a public service.  
- Reduce data size. Smaller data means buffers will take longer to fill up. Again, if the database cannot deal with the data volumes long term then this will not help much.
- Use physical disk buffering (for example, [Aeron Archive](https://aeroncookbook.com/aeron-archive/overview/)) on the publisher to allow the publisher to write freely while consumer(s) consume as fast as they can. This only works while you have sufficient disk space for the buffering. 
- Reduce publisher data volume. Consider conflating the data within the data source connector, so that the output data is a subset of the input data.
- Investigate protocol improvements. For example, instead of having the publisher push data endless, have it push data in batches on the request of consumers.
- Disconnect the slow consumer.

---

## Backlinks

<div class="flex flex-row p-2 rounded-md">
    <div class="pr-2">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" width="24" height="24" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />
</svg>
    </div>
    <div>
         <a href="../../note/distributed-systems-faults/">Distributed system faults</a>
    </div>
</div>

---

## References

<div class="flex flex-row p-2 rounded-md">
<div class="pr-2">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
</svg>
</div>
<div>Martin Kleppmann: Designing Data-Intensive Applications, 2017. Published by Oâ€™Reilly Media, Inc.
</div>
</div>

<div class="flex flex-row p-2 rounded-md">
<div class="pr-2">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
</svg>
</div>
<div>Dimos Raptis: Distributed Systems for Practitioners, 2020. Available on Kindle and Leanpub.
</div>
</div>

<div class="flex flex-row p-2 rounded-md">
<div class="pr-2">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
</svg>
</div>
<div>
<a href="https://en.wikipedia.org/wiki/Back_pressure">Wikipedia article on Backpressure</a>.
</div>
</div>

<div class="flex flex-row p-2 rounded-md">
<div class="pr-2">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
</svg>
</div>
<div><a href="https://www.reactivemanifesto.org/glossary#Back-Pressure">Reactive Manifesto Glossary</a>.
</div>
</div>

<div class="flex flex-row p-2 rounded-md">
<div class="pr-2">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
</svg>
</div>
<div>
Jay Phelps:<a href="https://medium.com/@jayphelps/backpressure-explained-the-flow-of-data-through-software-2350b3e77ce7">Backpressure explained â€” the resisted flow of data through software</a>.
</div>
</div>


 
---

## Change log

- Added 12 December 2020 
